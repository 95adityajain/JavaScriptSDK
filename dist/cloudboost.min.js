function _all(a){return jQuery.when.apply(jQuery,a).then(function(){return Array.prototype.slice.call(arguments,0)})}function trimStart(a,b){for(var c=0;b[c]===a;)c++;return b.substr(c)}function greatCircleFormula(a,b){var c=(a.document.coordinates[1]-b.document.coordinates[1]).toRad(),d=(a.document.coordinates[0]-b.document.coordinates[0]).toRad(),e=b.document.coordinates[1].toRad(),f=a.document.coordinates[1].toRad(),g=Math.sin(c/2)*Math.sin(c/2)+Math.sin(d/2)*Math.sin(d/2)*Math.cos(e)*Math.cos(f),h=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g));return h}var CB=CB||{};if(CB.version="1.0.0",CB._isNode=!1,CB.Socket=null,CB.io=null,CB.apiUrl="https://api.cloudboost.io",CB.appId=CB.appId||null,CB.appKey=CB.appKey||null,"undefined"!=typeof process&&process.versions&&process.versions.node?CB._isNode=!0:CB._isNode=!1,CB._ajaxIE8=function(a,b,c){var d=new CB.Promise,e=new XDomainRequest;return e.onload=function(){var a;try{a=JSON.parse(e.responseText)}catch(b){d.reject(b)}a&&d.resolve(a)},e.onerror=e.ontimeout=function(){var a={responseText:JSON.stringify({code:500,error:"IE's XDomainRequest does not supply error info."})};d.reject(a)},e.onprogress=function(){},e.open(a,b),e.send(c),d},CB._loadXml=function(){var a,b="function"==typeof require?require:null;return"undefined"!=typeof XMLHttpRequest?a=XMLHttpRequest:"function"==typeof require&&"undefined"==typeof require.ensure&&(a=b("xmlhttprequest").XMLHttpRequest),a=new a},CB.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[],this._isPromisesAPlusCompliant=!1,this.is=function(a){return a&&a.then&&"[object Function]"===Object.prototype.toString.call(a.then)},this.as=function(){var a=new CB.Promise;return a.resolve.apply(a,arguments),a},this.error=function(){var a=new CB.Promise;return a.reject.apply(a,arguments),a},this.when=function(a){var b;b=!a||"undefined"!=typeof a.length&&null!==a.length?a:arguments;var c=b.length,d=!1,e=[],f=[];if(e.length=b.length,f.length=b.length,0===c)return CB.Promise.as.apply(this,e);var g=new CB.Promise,h=function(){c-=1,0===c&&(d?g.reject(f):g.resolve.apply(g,e))};return b.forEach(function(a,b){CB.Promise.is(a)?a.then(function(a){e[b]=a,h()},function(a){f[b]=a,d=!0,h()}):(e[b]=a,h())}),g},this._continueWhile=function(a,b){return a()?b().then(function(){return CB.Promise._continueWhile(a,b)}):CB.Promise.as()}},CB.Promise.is=function(a){return a&&a.then&&"[object Function]"===Object.prototype.toString.call(a.then)},CB.Promise.prototype.resolve=function(a){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0,this._result=arguments;var b=arguments;this._resolvedCallbacks.forEach(function(a){a.apply(this,b)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},CB.Promise.prototype.reject=function(a){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=a,this._rejectedCallbacks.forEach(function(b){b(a)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},CB.Promise.prototype.then=function(a,b){var c=new CB.Promise,d=function(){var b=arguments;if(a)if(CB.Promise._isPromisesAPlusCompliant)try{b=[a.apply(this,b)]}catch(d){b=[CB.Promise.error(d)]}else b=[a.apply(this,b)];1===b.length&&CB.Promise.is(b[0])?b[0].then(function(){c.resolve.apply(c,arguments)},function(a){c.reject(a)}):c.resolve.apply(c,b)},e=function(a){var d=[];if(b){if(CB.Promise._isPromisesAPlusCompliant)try{d=[b(a)]}catch(e){d=[CB.Promise.error(e)]}else d=[b(a)];1===d.length&&CB.Promise.is(d[0])?d[0].then(function(){c.resolve.apply(c,arguments)},function(a){c.reject(a)}):CB.Promise._isPromisesAPlusCompliant?c.resolve.apply(c,d):c.reject(d[0])}else c.reject(a)},f=function(a){a.call()};CB.Promise._isPromisesAPlusCompliant&&("undefined"!=typeof window&&window.setTimeout?f=function(a){window.setTimeout(a,0)}:"undefined"!=typeof process&&process.nextTick&&(f=function(a){process.nextTick(a)}));var g=this;return this._resolved?f(function(){d.apply(g,g._result)}):this._rejected?f(function(){e(g._error)}):(this._resolvedCallbacks.push(d),this._rejectedCallbacks.push(e)),c},CB.Promise.prototype.always=function(a){return this.then(a,a)},CB.Promise.prototype.done=function(a){return this.then(a)},CB.Promise.prototype.fail=function(a){return this.then(null,a)},CB.clone=function(a){return"[object Object]"===!Object.prototype.toString.call(a)?a:"[object Array]"===Object.prototype.toString.call(a)?a.slice():new Object(a)},CB.Promise.prototype._thenRunCallbacks=function(a,b){var c;if("[object Function]"===Object.prototype.toString.call(a)){var d=a;c={success:function(a){d(a,null)},error:function(a){d(null,a)}}}else c=CB.clone(a);return c=c||{},this.then(function(a){return c.success?c.success.apply(this,arguments):b&&b.trigger("sync",b,a,c),CB.Promise.as.apply(CB.Promise,arguments)},function(a){return c.error?c.error(a):b&&b.trigger("error",b,a,c),CB.Promise.error(a)})},CB.Promise.all=function(a){var b;b=Array.isArray(a)?a:arguments;var c=b.length,d=!1,e=[],f=[];if(e.length=b.length,f.length=b.length,0===c)return CB.Promise.as.apply(this,e);for(var g=new CB.Promise,h=function(){c--,0>=c&&(d?g.reject(f):g.resolve(e))},i=function(a,b){CB.Promise.is(a)?a.then(function(a){e[b]=a,h()},function(a){f[b]=a,d=!0,h()}):(e[j]=a,h())},j=0;j<b.length;j++)i(b[j],j);return g},CB.Events={trigger:function(a){var b,c,d,e,f,g,h;if(!(d=this._callbacks))return this;for(g=d.all,a=a.split(eventSplitter),h=slice.call(arguments,1),b=a.shift();b;){if(c=d[b])for(e=c.tail;(c=c.next)!==e;)c.callback.apply(c.context||this,h);if(c=g)for(e=c.tail,f=[b].concat(h);(c=c.next)!==e;)c.callback.apply(c.context||this,f);b=a.shift()}return this}},CB.Promise.prototype._continueWith=function(a){return this.then(function(){return a(arguments,null)},function(b){return a(null,b)})},CB.toJSON=function(a){if(a.constructor===Array){for(var b=0;b<a.length;b++)a[b]=CB.toJSON(a[b]);return a}var c=null,d=null,e=null,f=null,g=null;a instanceof CB.CloudGeoPoint&&(f=a.document.latitude,g=a.document.longitude),a instanceof CB.CloudFile&&(c=a.document._id),a instanceof CB.Column&&(d=a.document.name),a instanceof CB.CloudQueue&&(e=a.document.name),a instanceof CB.CloudTable&&(e=a.document.name),a instanceof CB.CloudCache&&(e=a.document.name);var h=CB._clone(a,c,f,g,e,d);if(!h instanceof CB.CloudObject||!h instanceof CB.CloudFile||!h instanceof CB.CloudGeoPoint||!h instanceof CB.CloudTable||!h instanceof CB.Column||!h instanceof CB.QueueMessage||!h instanceof CB.CloudQueue||!h instanceof CB.CloudCache)throw"Data passed is not an instance of CloudObject or CloudFile or CloudGeoPoint";if(h instanceof CB.Column)return h.document;if(h instanceof CB.CloudGeoPoint)return h.document;var i=h.document;for(var j in i)if(i[j]instanceof CB.CloudObject||i[j]instanceof CB.CloudFile||i[j]instanceof CB.CloudGeoPoint||i[j]instanceof CB.Column||i[j]instanceof CB.QueueMessage||i[j]instanceof CB.CloudQueue||i[j]instanceof CB.CloudCache)i[j]=CB.toJSON(i[j]);else if("ACL"===j){var k=i[j].document;i[j]=k}else if(i[j]instanceof Array&&i[j][0]&&(i[j][0]instanceof CB.CloudObject||i[j][0]instanceof CB.CloudFile||i[j][0]instanceof CB.CloudGeoPoint||i[j][0]instanceof CB.Column||i[j][0]instanceof CB.QueueMessage||i[j][0]instanceof CB.CloudQueue||i[j][0]instanceof CB.CloudCache)){for(var l=[],b=0;b<i[j].length;b++)l.push(CB.toJSON(i[j][b]));i[j]=l}return i},CB.fromJSON=function(a,b){if(!a||""===a)return null;if(a instanceof Array){if(a[0]&&a[0]instanceof Object){for(var c=[],d=0;d<a.length;d++)k=CB.fromJSON(a[d]),c.push(k);return c}return a}if(a instanceof Object&&a._type){var e={};for(var f in a)a[f]instanceof Array?e[f]=CB.fromJSON(a[f]):a[f]instanceof Object?"ACL"===f?(e[f]=new CB.ACL,e[f].document=a[f]):a[f]._type?b?e[f]=CB.fromJSON(a[f],b.get(f)):e[f]=CB.fromJSON(a[f]):e[f]=a[f]:e[f]=a[f];if(b)b.document=e;else{var g=null,h=null,i=null,j=null;"file"===e._type&&(g=e._id),"point"===e._type&&(h=e.latitude,i=e.longitude),"table"===e._type&&(j=e.name),"column"===e._type&&(j=e.name),"queue"===e._type&&(j=e.name),"cache"===e._type&&(j=e.name);var k=CB._getObjectByType(e._type,g,h,i,j);k.document=e,b=k}return(b instanceof CB.CloudObject||b instanceof CB.CloudUser||b instanceof CB.CloudRole||b instanceof CB.CloudQueue||b instanceof CB.QueueMessage||b instanceof CB.CloudFile||b instanceof CB.CloudCache)&&b.document.ACL&&(b.document.ACL.parent=b),b}return a},CB._getObjectByType=function(a,b,c,d,e){var f=null;return"custom"===a&&(f=new CB.CloudObject),"queue"===a&&(f=new CB.CloudQueue(e)),"queue-message"===a&&(f=new CB.QueueMessage),"cache"===a&&(f=new CB.CloudCache(e)),"role"===a&&(f=new CB.CloudRole),"user"===a&&(f=new CB.CloudUser),"file"===a&&(f=new CB.CloudFile(b)),"point"===a&&(f=new CB.CloudGeoPoint(c,d)),"table"===a&&(f=new CB.CloudTable(e)),"column"===a&&(f=new CB.Column(e)),f},CB._validate=function(){if(!CB.appId)throw"AppID is null. Please use CB.CloudApp.init to initialize your app.";if(!CB.appKey)throw"AppKey is null. Please use CB.CloudApp.init to initialize your app."},function(){new Object}(),CB._isNode&&(module.exports={},module.exports=CB),CB._clone=function(a,b,c,d,e,f){var g={};if(a.document._type&&"point"!=a.document._type){g=CB._getObjectByType(a.document._type,b,c,d,e,f);var h=a.document,i={};for(var j in h)h[j]instanceof CB.CloudFile?i[j]=CB._clone(h[j],h[j].document._id):h[j]instanceof CB.CloudObject?i[j]=CB._clone(h[j],null):h[j]instanceof CB.CloudQueue?i[j]=CB._clone(h[j],null):h[j]instanceof CB.QueueMessage?i[j]=CB._clone(h[j],null):h[j]instanceof CB.CloudGeoPoint?i[j]=CB._clone(h[j],null):h[j]instanceof CB.CloudCache?i[j]=CB._clone(h[j],null):i[j]=h[j]}else if(a instanceof CB.CloudGeoPoint)return g=new CB.CloudGeoPoint(a.get("longitude"),a.get("latitude"));return g.document=i,g},CB._request=function(a,b,c,d,e,f){if(CB._validate(),c||(c={}),c.sdk="JavaScript",!CB.CloudApp._isConnected)throw"Your CloudApp is disconnected. Please use CB.CloudApp.connect() and try again.";var g=new CB.Promise,h=CB._loadXml();if(CB._isNode){var i=require("node-localstorage").LocalStorage;localStorage=new i("./scratch")}if(h.open(a,b,!0),e||h.setRequestHeader("Content-Type","text/plain"),f&&"undefined"!=typeof h.upload&&h.upload.addEventListener("progress",function(a){if(a.lengthComputable){var b=a.loaded/a.total;f(b)}},!1),!d){var j=CB._getSessionId();null!=j&&h.setRequestHeader("sessionID",j)}return CB._isNode&&(h.setRequestHeader("User-Agent","CB/"+CB.version+" (NodeJS "+process.versions.node+")"),c&&"object"==typeof c&&(c=JSON.stringify(c))),c?h.send(c):h.send(),h.onreadystatechange=function(){if(h.readyState==h.DONE)if(200==h.status){if(!d){var a=h.getResponseHeader("sessionID");a?localStorage.setItem("sessionID",a):localStorage.removeItem("sessionID")}g.resolve(h.responseText)}else g.reject(h.responseText)},g},CB._getSessionId=function(){return localStorage.getItem("sessionID")},CB._columnValidation=function(a,b){var c=["id","createdAt","updatedAt","ACL"];"user"==b.document.type?c.concat(["username","email","password","roles"]):"role"==b.document.type&&c.push("name");var d=c.indexOf(a.name.toLowerCase());return-1===d},CB._tableValidation=function(a){if(!a)throw"table name cannot be empty";if(!isNaN(a[0]))throw"table name should not start with a number";if(!a.match(/^\S+$/))throw"table name should not contain spaces";var b=new RegExp(/[~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/);if(b.test(a))throw"table not shoul not contain special characters"},CB._modified=function(a,b){a.document._isModified=!0,a.document._modifiedColumns?-1===a.document._modifiedColumns.indexOf(b)&&a.document._modifiedColumns.push(b):(a.document._modifiedColumns=[],a.document._modifiedColumns.push(b))},CB._columnNameValidation=function(a){if(!a)throw"table name cannot be empty";if(!isNaN(a[0]))throw"column name should not start with a number";if(!a.match(/^\S+$/))throw"column name should not contain spaces";var b=new RegExp(/[~`!#$%\^&*+=\-\[\]\\';,\/{}|\\":<>\?]/);if(b.test(a))throw"column name not should not contain special characters"},CB._columnDataTypeValidation=function(a){if(!a)throw"data type cannot be empty";var b=["Text","Email","URL","Number","Boolean","DateTime","GeoPoint","File","List","Relation","Object","EncryptedText"],c=b.indexOf(a);if(0>c)throw"invalid data type"},CB._defaultColumns=function(a){var b=new CB.Column("id");b.dataType="Id",b.required=!0,b.unique=!0,b.document.isDeletable=!1,b.document.isEditable=!1;var c=new CB.Column("expires");c.dataType="DateTime",c.document.isDeletable=!1,c.document.isEditable=!1;var d=new CB.Column("createdAt");d.dataType="DateTime",d.required=!0,d.document.isDeletable=!1,d.document.isEditable=!1;var e=new CB.Column("updatedAt");e.dataType="DateTime",e.required=!0,e.document.isDeletable=!1,e.document.isEditable=!1;var f=new CB.Column("ACL");f.dataType="ACL",f.required=!0,f.document.isDeletable=!1,f.document.isEditable=!1;var g=[b,c,e,d,f];if("custom"===a)return g;if("user"===a){var h=new CB.Column("username");h.dataType="Text",h.required=!1,h.unique=!0,h.document.isDeletable=!1,h.document.isEditable=!1;var i=new CB.Column("email");i.dataType="Email",i.unique=!0,i.document.isDeletable=!1,i.document.isEditable=!1;var j=new CB.Column("password");j.dataType="EncryptedText",j.required=!1,j.document.isDeletable=!1,j.document.isEditable=!1;var k=new CB.Column("roles");k.dataType="List",k.relatedTo="Role",k.relatedToType="role",k.document.relationType="table",k.document.isDeletable=!1,k.document.isEditable=!1;var l=new CB.Column("socialAuth");return l.dataType="List",l.relatedTo="Object",l.required=!1,l.document.isDeletable=!1,l.document.isEditable=!1,g.push(h),g.push(k),g.push(j),g.push(i),g.push(l),g}if("role"===a){var m=new CB.Column("name");return m.dataType="Text",m.unique=!0,m.required=!0,m.document.isDeletable=!1,m.document.isEditable=!1,g.push(m),g}if("device"===a){var n=new CB.Column("channels");n.dataType="List",n.relatedTo="Text",n.document.isDeletable=!1,n.document.isEditable=!1;var o=new CB.Column("deviceToken");o.dataType="Text",o.unique=!0,o.document.isDeletable=!1,o.document.isEditable=!1;var p=new CB.Column("deviceOS");p.dataType="Text",p.document.isDeletable=!1,p.document.isEditable=!1;var q=new CB.Column("timezone");q.dataType="Text",q.document.isDeletable=!1,q.document.isEditable=!1;var r=new CB.Column("metadata");return r.dataType="Object",r.document.isDeletable=!1,r.document.isEditable=!1,g.push(n),g.push(o),g.push(p),g.push(q),g.push(r),g}},CB._fileCheck=function(a){var b=new CB.Promise,c=[];for(var d in a.document)if(a.document[d]instanceof Array&&a.document[d][0]instanceof CB.CloudFile)for(var e=0;e<a.document[d].length;e++)a.document[d][e].id||c.push(a.document[d][e].save());else a.document[d]instanceof Object&&a.document[d]instanceof CB.CloudFile&&(a.document[d].id||c.push(a.document[d].save()));return c.length>0?CB.Promise.all(c).then(function(){var c=arguments,d=0;for(var e in a.document)if(a.document[e]instanceof Array&&a.document[e][0]instanceof CB.CloudFile)for(var f=0;f<a.document[e].length;f++)a.document[e][f].id||(a.document[e][f]=c[d],d+=1);else a.document[e]instanceof Object&&a.document[e]instanceof CB.CloudFile&&(a.document[e].id||(a.document[e]=c[d],d+=1));b.resolve(a)},function(a){b.reject(a)}):b.resolve(a),b},CB._bulkObjFileCheck=function(a){for(var b=new CB.Promise,c=[],d=0;d<a.length;d++)c.push(CB._fileCheck(a[d]));return CB.Promise.all(c).then(function(){b.resolve(arguments)},function(a){b.reject(a)}),b},CB._generateHash=function(){var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(i=0;i<8;i++)a+=b.charAt(Math.floor(Math.random()*b.length));return a},CB._isJsonString=function(a){try{JSON.parse(a)}catch(b){return!1}return!0},CB._getCookie=function(a){if("undefined"!=typeof Storage){if(new Date(localStorage.getItem(a+"_expires"))>new Date)return localStorage.getItem(a);CB._deleteCookie(a)}else if("undefined"!=typeof document){for(var a=a+"=",b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1);if(0==d.indexOf(a))return d.substring(a.length,d.length)}return""}},CB._deleteCookie=function(a){if("undefined"!=typeof Storage)localStorage.removeItem(a),localStorage.removeItem(a+"_expires");else if("undefined"!=typeof document){var b=new Date;b.setTime(b.getTime()+0);var c="expires="+b.toUTCString();document.cookie=a+"=NaN"+c}},CB._createCookie=function(a,b,c){var d=new Date;if(d.setTime(d.getTime()+c),"undefined"!=typeof Storage)localStorage.setItem(a,b.toString()),localStorage.setItem(a+"_expires",d);else if("undefined"!=typeof document){var c="expires="+d.toUTCString();document.cookie=+a+"="+b.toString()+"; "+c}},CB._getQuerystringByKey=function(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var b=new RegExp("[\\?&]"+a+"=([^&#]*)"),c=b.exec(location.search);return null===c?"":decodeURIComponent(c[1].replace(/\+/g," "))},"undefined"!=typeof location&&location.search){var cbtoken=CB._getQuerystringByKey("cbtoken");cbtoken&&""!==cbtoken&&localStorage.setItem("sessionID",cbtoken)}CB._isNode||!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.io=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./lib/")},{"./lib/":2}],2:[function(a,b,c){b.exports=a("./socket"),b.exports.parser=a("engine.io-parser")},{"./socket":3,"engine.io-parser":19}],3:[function(a,b,c){(function(c){function d(a,b){if(!(this instanceof d))return new d(a,b);b=b||{},a&&"object"==typeof a&&(b=a,a=null),a?(a=k(a),b.hostname=a.host,b.secure="https"==a.protocol||"wss"==a.protocol,b.port=a.port,a.query&&(b.query=a.query)):b.host&&(b.hostname=k(b.host).host),this.secure=null!=b.secure?b.secure:c.location&&"https:"==location.protocol,b.hostname&&!b.port&&(b.port=this.secure?"443":"80"),this.agent=b.agent||!1,this.hostname=b.hostname||(c.location?location.hostname:"localhost"),this.port=b.port||(c.location&&location.port?location.port:this.secure?443:80),this.query=b.query||{},"string"==typeof this.query&&(this.query=m.decode(this.query)),this.upgrade=!1!==b.upgrade,this.path=(b.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!b.forceJSONP,this.jsonp=!1!==b.jsonp,this.forceBase64=!!b.forceBase64,this.enablesXDR=!!b.enablesXDR,this.timestampParam=b.timestampParam||"t",this.timestampRequests=b.timestampRequests,this.transports=b.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.policyPort=b.policyPort||843,this.rememberUpgrade=b.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=b.onlyBinaryUpgrades,this.perMessageDeflate=!1!==b.perMessageDeflate?b.perMessageDeflate||{}:!1,!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=b.pfx||null,this.key=b.key||null,this.passphrase=b.passphrase||null,this.cert=b.cert||null,this.ca=b.ca||null,this.ciphers=b.ciphers||null,this.rejectUnauthorized=void 0===b.rejectUnauthorized?null:b.rejectUnauthorized;var e="object"==typeof c&&c;e.global===e&&b.extraHeaders&&Object.keys(b.extraHeaders).length>0&&(this.extraHeaders=b.extraHeaders),this.open()}function e(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}var f=a("./transports"),g=a("component-emitter"),h=a("debug")("engine.io-client:socket"),i=a("indexof"),j=a("engine.io-parser"),k=a("parseuri"),l=a("parsejson"),m=a("parseqs");b.exports=d,d.priorWebsocketSuccess=!1,g(d.prototype),d.protocol=j.protocol,d.Socket=d,d.Transport=a("./transport"),d.transports=a("./transports"),d.parser=a("engine.io-parser"),d.prototype.createTransport=function(a){h('creating transport "%s"',a);var b=e(this.query);b.EIO=j.protocol,b.transport=a,this.id&&(b.sid=this.id);var c=new f[a]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:b,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized,perMessageDeflate:this.perMessageDeflate,extraHeaders:this.extraHeaders});return c},d.prototype.open=function(){var a;if(this.rememberUpgrade&&d.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))a="websocket";else{if(0===this.transports.length){var b=this;return void setTimeout(function(){b.emit("error","No transports available")},0)}a=this.transports[0]}this.readyState="opening";try{a=this.createTransport(a)}catch(c){return this.transports.shift(),void this.open()}a.open(),this.setTransport(a)},d.prototype.setTransport=function(a){h("setting transport %s",a.name);var b=this;this.transport&&(h("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=a,a.on("drain",function(){b.onDrain()}).on("packet",function(a){b.onPacket(a)}).on("error",function(a){b.onError(a)}).on("close",function(){b.onClose("transport close")})},d.prototype.probe=function(a){function b(){if(m.onlyBinaryUpgrades){var b=!this.supportsBinary&&m.transport.supportsBinary;l=l||b}l||(h('probe transport "%s" opened',a),k.send([{type:"ping",data:"probe"}]),k.once("packet",function(b){if(!l)if("pong"==b.type&&"probe"==b.data){if(h('probe transport "%s" pong',a),m.upgrading=!0,m.emit("upgrading",k),!k)return;d.priorWebsocketSuccess="websocket"==k.name,h('pausing current transport "%s"',m.transport.name),m.transport.pause(function(){l||"closed"!=m.readyState&&(h("changing transport and sending upgrade packet"),j(),m.setTransport(k),k.send([{type:"upgrade"}]),m.emit("upgrade",k),k=null,m.upgrading=!1,m.flush())})}else{h('probe transport "%s" failed',a);var c=new Error("probe error");c.transport=k.name,m.emit("upgradeError",c)}}))}function c(){l||(l=!0,j(),k.close(),k=null)}function e(b){var d=new Error("probe error: "+b);d.transport=k.name,c(),h('probe transport "%s" failed because of error: %s',a,b),m.emit("upgradeError",d)}function f(){e("transport closed")}function g(){e("socket closed")}function i(a){k&&a.name!=k.name&&(h('"%s" works - aborting "%s"',a.name,k.name),c())}function j(){k.removeListener("open",b),k.removeListener("error",e),k.removeListener("close",f),m.removeListener("close",g),m.removeListener("upgrading",i)}h('probing transport "%s"',a);var k=this.createTransport(a,{probe:1}),l=!1,m=this;d.priorWebsocketSuccess=!1,k.once("open",b),k.once("error",e),k.once("close",f),this.once("close",g),this.once("upgrading",i),k.open()},d.prototype.onOpen=function(){if(h("socket open"),this.readyState="open",d.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){h("starting upgrade probes");for(var a=0,b=this.upgrades.length;b>a;a++)this.probe(this.upgrades[a])}},d.prototype.onPacket=function(a){if("opening"==this.readyState||"open"==this.readyState)switch(h('socket receive: type "%s", data "%s"',a.type,a.data),this.emit("packet",a),this.emit("heartbeat"),a.type){case"open":this.onHandshake(l(a.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var b=new Error("server error");b.code=a.data,this.onError(b);break;case"message":this.emit("data",a.data),this.emit("message",a.data)}else h('packet received with socket readyState "%s"',this.readyState)},d.prototype.onHandshake=function(a){this.emit("handshake",a),this.id=a.sid,this.transport.query.sid=a.sid,this.upgrades=this.filterUpgrades(a.upgrades),this.pingInterval=a.pingInterval,this.pingTimeout=a.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},d.prototype.onHeartbeat=function(a){clearTimeout(this.pingTimeoutTimer);var b=this;b.pingTimeoutTimer=setTimeout(function(){"closed"!=b.readyState&&b.onClose("ping timeout")},a||b.pingInterval+b.pingTimeout)},d.prototype.setPing=function(){var a=this;clearTimeout(a.pingIntervalTimer),a.pingIntervalTimer=setTimeout(function(){h("writing ping packet - expecting pong within %sms",a.pingTimeout),a.ping(),a.onHeartbeat(a.pingTimeout)},a.pingInterval)},d.prototype.ping=function(){var a=this;this.sendPacket("ping",function(){a.emit("ping")})},d.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},d.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(h("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},d.prototype.write=d.prototype.send=function(a,b,c){return this.sendPacket("message",a,b,c),this},d.prototype.sendPacket=function(a,b,c,d){if("function"==typeof b&&(d=b,b=void 0),"function"==typeof c&&(d=c,c=null),"closing"!=this.readyState&&"closed"!=this.readyState){c=c||{},c.compress=!1!==c.compress;var e={type:a,data:b,options:c};this.emit("packetCreate",e),this.writeBuffer.push(e),d&&this.once("flush",d),this.flush()}},d.prototype.close=function(){function a(){d.onClose("forced close"),h("socket closing - telling transport to close"),d.transport.close()}function b(){d.removeListener("upgrade",b),d.removeListener("upgradeError",b),a()}function c(){d.once("upgrade",b),d.once("upgradeError",b)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var d=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?c():a()}):this.upgrading?c():a()}return this},d.prototype.onError=function(a){h("socket error %j",a),d.priorWebsocketSuccess=!1,this.emit("error",a),this.onClose("transport error",a)},d.prototype.onClose=function(a,b){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){h('socket close with reason: "%s"',a);var c=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",a,b),c.writeBuffer=[],c.prevBufferLen=0}},d.prototype.filterUpgrades=function(a){for(var b=[],c=0,d=a.length;d>c;c++)~i(this.transports,a[c])&&b.push(a[c]);return b}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./transport":4,"./transports":5,"component-emitter":15,debug:17,"engine.io-parser":19,indexof:23,parsejson:26,parseqs:27,parseuri:28}],4:[function(a,b,c){function d(a){this.path=a.path,this.hostname=a.hostname,this.port=a.port,this.secure=a.secure,this.query=a.query,this.timestampParam=a.timestampParam,this.timestampRequests=a.timestampRequests,this.readyState="",this.agent=a.agent||!1,this.socket=a.socket,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized,this.extraHeaders=a.extraHeaders}var e=a("engine.io-parser"),f=a("component-emitter");b.exports=d,f(d.prototype),d.prototype.onError=function(a,b){var c=new Error(a);return c.type="TransportError",c.description=b,this.emit("error",c),this},d.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},d.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},d.prototype.send=function(a){if("open"!=this.readyState)throw new Error("Transport not open");this.write(a)},d.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},d.prototype.onData=function(a){var b=e.decodePacket(a,this.socket.binaryType);this.onPacket(b)},d.prototype.onPacket=function(a){this.emit("packet",a)},d.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":15,"engine.io-parser":19}],5:[function(a,b,c){(function(b){function d(a){var c,d=!1,h=!1,i=!1!==a.jsonp;if(b.location){var j="https:"==location.protocol,k=location.port;k||(k=j?443:80),d=a.hostname!=location.hostname||k!=a.port,h=a.secure!=j}if(a.xdomain=d,a.xscheme=h,c=new e(a),"open"in c&&!a.forceJSONP)return new f(a);if(!i)throw new Error("JSONP disabled");return new g(a)}var e=a("xmlhttprequest-ssl"),f=a("./polling-xhr"),g=a("./polling-jsonp"),h=a("./websocket");c.polling=d,c.websocket=h}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling-jsonp":6,"./polling-xhr":7,"./websocket":9,"xmlhttprequest-ssl":10}],6:[function(a,b,c){(function(c){function d(){}function e(a){f.call(this,a),this.query=this.query||{},h||(c.___eio||(c.___eio=[]),h=c.___eio),this.index=h.length;var b=this;h.push(function(a){b.onData(a)}),this.query.j=this.index,c.document&&c.addEventListener&&c.addEventListener("beforeunload",function(){b.script&&(b.script.onerror=d)},!1)}var f=a("./polling"),g=a("component-inherit");b.exports=e;var h,i=/\n/g,j=/\\n/g;g(e,f),e.prototype.supportsBinary=!1,e.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),f.prototype.doClose.call(this)},e.prototype.doPoll=function(){var a=this,b=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),b.async=!0,b.src=this.uri(),b.onerror=function(b){a.onError("jsonp poll error",b)};var c=document.getElementsByTagName("script")[0];c?c.parentNode.insertBefore(b,c):(document.head||document.body).appendChild(b),this.script=b;var d="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);d&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},e.prototype.doWrite=function(a,b){function c(){d(),b()}function d(){if(e.iframe)try{e.form.removeChild(e.iframe)}catch(a){e.onError("jsonp polling iframe removal error",a)}try{var b='<iframe src="javascript:0" name="'+e.iframeId+'">';f=document.createElement(b)}catch(a){f=document.createElement("iframe"),f.name=e.iframeId,f.src="javascript:0"}f.id=e.iframeId,e.form.appendChild(f),e.iframe=f}var e=this;if(!this.form){var f,g=document.createElement("form"),h=document.createElement("textarea"),k=this.iframeId="eio_iframe_"+this.index;g.className="socketio",g.style.position="absolute",g.style.top="-1000px",g.style.left="-1000px",g.target=k,g.method="POST",g.setAttribute("accept-charset","utf-8"),h.name="d",g.appendChild(h),document.body.appendChild(g),this.form=g,this.area=h}this.form.action=this.uri(),d(),a=a.replace(j,"\\\n"),this.area.value=a.replace(i,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-inherit":16}],7:[function(a,b,c){(function(c){function d(){}function e(a){if(i.call(this,a),
c.location){var b="https:"==location.protocol,d=location.port;d||(d=b?443:80),this.xd=a.hostname!=c.location.hostname||d!=a.port,this.xs=a.secure!=b}else this.extraHeaders=a.extraHeaders}function f(a){this.method=a.method||"GET",this.uri=a.uri,this.xd=!!a.xd,this.xs=!!a.xs,this.async=!1!==a.async,this.data=void 0!=a.data?a.data:null,this.agent=a.agent,this.isBinary=a.isBinary,this.supportsBinary=a.supportsBinary,this.enablesXDR=a.enablesXDR,this.pfx=a.pfx,this.key=a.key,this.passphrase=a.passphrase,this.cert=a.cert,this.ca=a.ca,this.ciphers=a.ciphers,this.rejectUnauthorized=a.rejectUnauthorized,this.extraHeaders=a.extraHeaders,this.create()}function g(){for(var a in f.requests)f.requests.hasOwnProperty(a)&&f.requests[a].abort()}var h=a("xmlhttprequest-ssl"),i=a("./polling"),j=a("component-emitter"),k=a("component-inherit"),l=a("debug")("engine.io-client:polling-xhr");b.exports=e,b.exports.Request=f,k(e,i),e.prototype.supportsBinary=!0,e.prototype.request=function(a){return a=a||{},a.uri=this.uri(),a.xd=this.xd,a.xs=this.xs,a.agent=this.agent||!1,a.supportsBinary=this.supportsBinary,a.enablesXDR=this.enablesXDR,a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized,a.extraHeaders=this.extraHeaders,new f(a)},e.prototype.doWrite=function(a,b){var c="string"!=typeof a&&void 0!==a,d=this.request({method:"POST",data:a,isBinary:c}),e=this;d.on("success",b),d.on("error",function(a){e.onError("xhr post error",a)}),this.sendXhr=d},e.prototype.doPoll=function(){l("xhr poll");var a=this.request(),b=this;a.on("data",function(a){b.onData(a)}),a.on("error",function(a){b.onError("xhr poll error",a)}),this.pollXhr=a},j(f.prototype),f.prototype.create=function(){var a={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};a.pfx=this.pfx,a.key=this.key,a.passphrase=this.passphrase,a.cert=this.cert,a.ca=this.ca,a.ciphers=this.ciphers,a.rejectUnauthorized=this.rejectUnauthorized;var b=this.xhr=new h(a),d=this;try{l("xhr open %s: %s",this.method,this.uri),b.open(this.method,this.uri,this.async);try{if(this.extraHeaders){b.setDisableHeaderCheck(!0);for(var e in this.extraHeaders)this.extraHeaders.hasOwnProperty(e)&&b.setRequestHeader(e,this.extraHeaders[e])}}catch(g){}if(this.supportsBinary&&(b.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?b.setRequestHeader("Content-type","application/octet-stream"):b.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(g){}"withCredentials"in b&&(b.withCredentials=!0),this.hasXDR()?(b.onload=function(){d.onLoad()},b.onerror=function(){d.onError(b.responseText)}):b.onreadystatechange=function(){4==b.readyState&&(200==b.status||1223==b.status?d.onLoad():setTimeout(function(){d.onError(b.status)},0))},l("xhr data %s",this.data),b.send(this.data)}catch(g){return void setTimeout(function(){d.onError(g)},0)}c.document&&(this.index=f.requestsCount++,f.requests[this.index]=this)},f.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},f.prototype.onData=function(a){this.emit("data",a),this.onSuccess()},f.prototype.onError=function(a){this.emit("error",a),this.cleanup(!0)},f.prototype.cleanup=function(a){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=d:this.xhr.onreadystatechange=d,a)try{this.xhr.abort()}catch(b){}c.document&&delete f.requests[this.index],this.xhr=null}},f.prototype.onLoad=function(){var a;try{var b;try{b=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(c){}if("application/octet-stream"===b)a=this.xhr.response;else if(this.supportsBinary)try{a=String.fromCharCode.apply(null,new Uint8Array(this.xhr.response))}catch(c){for(var d=new Uint8Array(this.xhr.response),e=[],f=0,g=d.length;g>f;f++)e.push(d[f]);a=String.fromCharCode.apply(null,e)}else a=this.xhr.responseText}catch(c){this.onError(c)}null!=a&&this.onData(a)},f.prototype.hasXDR=function(){return"undefined"!=typeof c.XDomainRequest&&!this.xs&&this.enablesXDR},f.prototype.abort=function(){this.cleanup()},c.document&&(f.requestsCount=0,f.requests={},c.attachEvent?c.attachEvent("onunload",g):c.addEventListener&&c.addEventListener("beforeunload",g,!1))}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./polling":8,"component-emitter":15,"component-inherit":16,debug:17,"xmlhttprequest-ssl":10}],8:[function(a,b,c){function d(a){var b=a&&a.forceBase64;k&&!b||(this.supportsBinary=!1),e.call(this,a)}var e=a("../transport"),f=a("parseqs"),g=a("engine.io-parser"),h=a("component-inherit"),i=a("yeast"),j=a("debug")("engine.io-client:polling");b.exports=d;var k=function(){var b=a("xmlhttprequest-ssl"),c=new b({xdomain:!1});return null!=c.responseType}();h(d,e),d.prototype.name="polling",d.prototype.doOpen=function(){this.poll()},d.prototype.pause=function(a){function b(){j("paused"),c.readyState="paused",a()}var c=this;if(this.readyState="pausing",this.polling||!this.writable){var d=0;this.polling&&(j("we are currently polling - waiting to pause"),d++,this.once("pollComplete",function(){j("pre-pause polling complete"),--d||b()})),this.writable||(j("we are currently writing - waiting to pause"),d++,this.once("drain",function(){j("pre-pause writing complete"),--d||b()}))}else b()},d.prototype.poll=function(){j("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},d.prototype.onData=function(a){var b=this;j("polling got data %s",a);var c=function(a,c,d){return"opening"==b.readyState&&b.onOpen(),"close"==a.type?(b.onClose(),!1):void b.onPacket(a)};g.decodePayload(a,this.socket.binaryType,c),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():j('ignoring poll - transport state "%s"',this.readyState))},d.prototype.doClose=function(){function a(){j("writing close packet"),b.write([{type:"close"}])}var b=this;"open"==this.readyState?(j("transport open - closing"),a()):(j("transport not open - deferring close"),this.once("open",a))},d.prototype.write=function(a){var b=this;this.writable=!1;var c=function(){b.writable=!0,b.emit("drain")},b=this;g.encodePayload(a,this.supportsBinary,function(a){b.doWrite(a,c)})},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"https":"http",c="";!1!==this.timestampRequests&&(a[this.timestampParam]=i()),this.supportsBinary||a.sid||(a.b64=1),a=f.encode(a),this.port&&("https"==b&&443!=this.port||"http"==b&&80!=this.port)&&(c=":"+this.port),a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a}},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,"xmlhttprequest-ssl":10,yeast:30}],9:[function(a,b,c){(function(c){function d(a){var b=a&&a.forceBase64;b&&(this.supportsBinary=!1),this.perMessageDeflate=a.perMessageDeflate,e.call(this,a)}var e=a("../transport"),f=a("engine.io-parser"),g=a("parseqs"),h=a("component-inherit"),i=a("yeast"),j=a("debug")("engine.io-client:websocket"),k=c.WebSocket||c.MozWebSocket,l=k;if(!l&&"undefined"==typeof window)try{l=a("ws")}catch(m){}b.exports=d,h(d,e),d.prototype.name="websocket",d.prototype.supportsBinary=!0,d.prototype.doOpen=function(){if(this.check()){var a=this.uri(),b=void 0,c={agent:this.agent,perMessageDeflate:this.perMessageDeflate};c.pfx=this.pfx,c.key=this.key,c.passphrase=this.passphrase,c.cert=this.cert,c.ca=this.ca,c.ciphers=this.ciphers,c.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(c.headers=this.extraHeaders),this.ws=k?new l(a):new l(a,b,c),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="buffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},d.prototype.addEventListeners=function(){var a=this;this.ws.onopen=function(){a.onOpen()},this.ws.onclose=function(){a.onClose()},this.ws.onmessage=function(b){a.onData(b.data)},this.ws.onerror=function(b){a.onError("websocket error",b)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(d.prototype.onData=function(a){var b=this;setTimeout(function(){e.prototype.onData.call(b,a)},0)}),d.prototype.write=function(a){function b(){d.emit("flush"),setTimeout(function(){d.writable=!0,d.emit("drain")},0)}var d=this;this.writable=!1;for(var e=a.length,g=0,h=e;h>g;g++)!function(a){f.encodePacket(a,d.supportsBinary,function(f){if(!k){var g={};if(a.options&&(g.compress=a.options.compress),d.perMessageDeflate){var h="string"==typeof f?c.Buffer.byteLength(f):f.length;h<d.perMessageDeflate.threshold&&(g.compress=!1)}}try{k?d.ws.send(f):d.ws.send(f,g)}catch(i){j("websocket closed before onclose event")}--e||b()})}(a[g])},d.prototype.onClose=function(){e.prototype.onClose.call(this)},d.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},d.prototype.uri=function(){var a=this.query||{},b=this.secure?"wss":"ws",c="";this.port&&("wss"==b&&443!=this.port||"ws"==b&&80!=this.port)&&(c=":"+this.port),this.timestampRequests&&(a[this.timestampParam]=i()),this.supportsBinary||(a.b64=1),a=g.encode(a),a.length&&(a="?"+a);var d=-1!==this.hostname.indexOf(":");return b+"://"+(d?"["+this.hostname+"]":this.hostname)+c+this.path+a},d.prototype.check=function(){return!(!l||"__initialize"in l&&this.name===d.prototype.name)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"../transport":4,"component-inherit":16,debug:17,"engine.io-parser":19,parseqs:27,ws:void 0,yeast:30}],10:[function(a,b,c){var d=a("has-cors");b.exports=function(a){var b=a.xdomain,c=a.xscheme,e=a.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!b||d))return new XMLHttpRequest}catch(f){}try{if("undefined"!=typeof XDomainRequest&&!c&&e)return new XDomainRequest}catch(f){}if(!b)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(f){}}},{"has-cors":22}],11:[function(a,b,c){function d(a,b,c){function d(a,e){if(d.count<=0)throw new Error("after called too many times");--d.count,a?(f=!0,b(a),b=c):0!==d.count||f||b(null,e)}var f=!1;return c=c||e,d.count=a,0===a?b():d}function e(){}b.exports=d},{}],12:[function(a,b,c){b.exports=function(a,b,c){var d=a.byteLength;if(b=b||0,c=c||d,a.slice)return a.slice(b,c);if(0>b&&(b+=d),0>c&&(c+=d),c>d&&(c=d),b>=d||b>=c||0===d)return new ArrayBuffer(0);for(var e=new Uint8Array(a),f=new Uint8Array(c-b),g=b,h=0;c>g;g++,h++)f[h]=e[g];return f.buffer}},{}],13:[function(a,b,c){!function(a){"use strict";c.encode=function(b){var c,d=new Uint8Array(b),e=d.length,f="";for(c=0;e>c;c+=3)f+=a[d[c]>>2],f+=a[(3&d[c])<<4|d[c+1]>>4],f+=a[(15&d[c+1])<<2|d[c+2]>>6],f+=a[63&d[c+2]];return e%3===2?f=f.substring(0,f.length-1)+"=":e%3===1&&(f=f.substring(0,f.length-2)+"=="),f},c.decode=function(b){var c,d,e,f,g,h=.75*b.length,i=b.length,j=0;"="===b[b.length-1]&&(h--,"="===b[b.length-2]&&h--);var k=new ArrayBuffer(h),l=new Uint8Array(k);for(c=0;i>c;c+=4)d=a.indexOf(b[c]),e=a.indexOf(b[c+1]),f=a.indexOf(b[c+2]),g=a.indexOf(b[c+3]),l[j++]=d<<2|e>>4,l[j++]=(15&e)<<4|f>>2,l[j++]=(3&f)<<6|63&g;return k}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],14:[function(a,b,c){(function(a){function c(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.buffer instanceof ArrayBuffer){var d=c.buffer;if(c.byteLength!==d.byteLength){var e=new Uint8Array(c.byteLength);e.set(new Uint8Array(d,c.byteOffset,c.byteLength)),d=e.buffer}a[b]=d}}}function d(a,b){b=b||{};var d=new f;c(a);for(var e=0;e<a.length;e++)d.append(a[e]);return b.type?d.getBlob(b.type):d.getBlob()}function e(a,b){return c(a),new Blob(a,b||{})}var f=a.BlobBuilder||a.WebKitBlobBuilder||a.MSBlobBuilder||a.MozBlobBuilder,g=function(){try{var a=new Blob(["hi"]);return 2===a.size}catch(b){return!1}}(),h=g&&function(){try{var a=new Blob([new Uint8Array([1,2])]);return 2===a.size}catch(b){return!1}}(),i=f&&f.prototype.append&&f.prototype.getBlob;b.exports=function(){return g?h?a.Blob:e:i?d:void 0}()}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],15:[function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks[a]=this._callbacks[a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){d.off(a,c),b.apply(this,arguments)}var d=this;return this._callbacks=this._callbacks||{},c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks[a];if(!c)return this;if(1==arguments.length)return delete this._callbacks[a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks[a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks[a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],16:[function(a,b,c){b.exports=function(a,b){var c=function(){};c.prototype=b.prototype,a.prototype=new c,a.prototype.constructor=a}},{}],17:[function(a,b,c){function d(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function e(){var a=arguments,b=this.useColors;if(a[0]=(b?"%c":"")+this.namespace+(b?" %c":" ")+a[0]+(b?"%c ":" ")+"+"+c.humanize(this.diff),!b)return a;var d="color: "+this.color;a=[a[0],d,"color: inherit"].concat(Array.prototype.slice.call(a,1));var e=0,f=0;return a[0].replace(/%[a-z%]/g,function(a){"%%"!==a&&(e++,"%c"===a&&(f=e))}),a.splice(f,0,d),a}function f(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function g(a){try{null==a?c.storage.removeItem("debug"):c.storage.debug=a}catch(b){}}function h(){var a;try{a=c.storage.debug}catch(b){}return a}function i(){try{return window.localStorage}catch(a){}}c=b.exports=a("./debug"),c.log=f,c.formatArgs=e,c.save=g,c.load=h,c.useColors=d,c.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:i(),c.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],c.formatters.j=function(a){return JSON.stringify(a)},c.enable(h())},{"./debug":18}],18:[function(a,b,c){function d(){return c.colors[k++%c.colors.length]}function e(a){function b(){}function e(){var a=e,b=+new Date,f=b-(j||b);a.diff=f,a.prev=j,a.curr=b,j=b,null==a.useColors&&(a.useColors=c.useColors()),null==a.color&&a.useColors&&(a.color=d());var g=Array.prototype.slice.call(arguments);g[0]=c.coerce(g[0]),"string"!=typeof g[0]&&(g=["%o"].concat(g));var h=0;g[0]=g[0].replace(/%([a-z%])/g,function(b,d){if("%%"===b)return b;h++;var e=c.formatters[d];if("function"==typeof e){var f=g[h];b=e.call(a,f),g.splice(h,1),h--}return b}),"function"==typeof c.formatArgs&&(g=c.formatArgs.apply(a,g));var i=e.log||c.log||console.log.bind(console);i.apply(a,g)}b.enabled=!1,e.enabled=!0;var f=c.enabled(a)?e:b;return f.namespace=a,f}function f(a){c.save(a);for(var b=(a||"").split(/[\s,]+/),d=b.length,e=0;d>e;e++)b[e]&&(a=b[e].replace(/\*/g,".*?"),"-"===a[0]?c.skips.push(new RegExp("^"+a.substr(1)+"$")):c.names.push(new RegExp("^"+a+"$")))}function g(){c.enable("")}function h(a){var b,d;for(b=0,d=c.skips.length;d>b;b++)if(c.skips[b].test(a))return!1;for(b=0,d=c.names.length;d>b;b++)if(c.names[b].test(a))return!0;return!1}function i(a){return a instanceof Error?a.stack||a.message:a}c=b.exports=e,c.coerce=i,c.disable=g,c.enable=f,c.enabled=h,c.humanize=a("ms"),c.names=[],c.skips=[],c.formatters={};var j,k=0},{ms:25}],19:[function(a,b,c){(function(b){function d(a,b){var d="b"+c.packets[a.type]+a.data.data;return b(d)}function e(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=a.data,f=new Uint8Array(e),g=new Uint8Array(1+e.byteLength);g[0]=r[a.type];for(var h=0;h<f.length;h++)g[h+1]=f[h];return d(g.buffer)}function f(a,b,d){if(!b)return c.encodeBase64Packet(a,d);var e=new FileReader;return e.onload=function(){a.data=e.result,c.encodePacket(a,b,!0,d)},e.readAsArrayBuffer(a.data)}function g(a,b,d){if(!b)return c.encodeBase64Packet(a,d);if(q)return f(a,b,d);var e=new Uint8Array(1);e[0]=r[a.type];var g=new u([e.buffer,a.data]);return d(g)}function h(a,b,c){for(var d=new Array(a.length),e=m(a.length,c),f=function(a,c,e){b(c,function(b,c){d[a]=c,e(b,d)})},g=0;g<a.length;g++)f(g,a[g],e)}var i=a("./keys"),j=a("has-binary"),k=a("arraybuffer.slice"),l=a("base64-arraybuffer"),m=a("after"),n=a("utf8"),o=navigator.userAgent.match(/Android/i),p=/PhantomJS/i.test(navigator.userAgent),q=o||p;c.protocol=3;var r=c.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},s=i(r),t={type:"error",data:"parser error"},u=a("blob");c.encodePacket=function(a,c,f,h){"function"==typeof c&&(h=c,c=!1),"function"==typeof f&&(h=f,f=null);var i=void 0===a.data?void 0:a.data.buffer||a.data;if(b.ArrayBuffer&&i instanceof ArrayBuffer)return e(a,c,h);if(u&&i instanceof b.Blob)return g(a,c,h);if(i&&i.base64)return d(a,h);var j=r[a.type];return void 0!==a.data&&(j+=f?n.encode(String(a.data)):String(a.data)),h(""+j)},c.encodeBase64Packet=function(a,d){var e="b"+c.packets[a.type];if(u&&a.data instanceof b.Blob){var f=new FileReader;return f.onload=function(){var a=f.result.split(",")[1];d(e+a)},f.readAsDataURL(a.data)}var g;try{g=String.fromCharCode.apply(null,new Uint8Array(a.data))}catch(h){for(var i=new Uint8Array(a.data),j=new Array(i.length),k=0;k<i.length;k++)j[k]=i[k];g=String.fromCharCode.apply(null,j)}return e+=b.btoa(g),d(e)},c.decodePacket=function(a,b,d){if("string"==typeof a||void 0===a){if("b"==a.charAt(0))return c.decodeBase64Packet(a.substr(1),b);if(d)try{a=n.decode(a)}catch(e){return t}var f=a.charAt(0);return Number(f)==f&&s[f]?a.length>1?{type:s[f],data:a.substring(1)}:{type:s[f]}:t}var g=new Uint8Array(a),f=g[0],h=k(a,1);return u&&"blob"===b&&(h=new u([h])),{type:s[f],data:h}},c.decodeBase64Packet=function(a,c){var d=s[a.charAt(0)];if(!b.ArrayBuffer)return{type:d,data:{base64:!0,data:a.substr(1)}};var e=l.decode(a.substr(1));return"blob"===c&&u&&(e=new u([e])),{type:d,data:e}},c.encodePayload=function(a,b,d){function e(a){return a.length+":"+a}function f(a,d){c.encodePacket(a,g?b:!1,!0,function(a){d(null,e(a))})}"function"==typeof b&&(d=b,b=null);var g=j(a);return b&&g?u&&!q?c.encodePayloadAsBlob(a,d):c.encodePayloadAsArrayBuffer(a,d):a.length?void h(a,f,function(a,b){return d(b.join(""))}):d("0:")},c.decodePayload=function(a,b,d){if("string"!=typeof a)return c.decodePayloadAsBinary(a,b,d);"function"==typeof b&&(d=b,b=null);var e;if(""==a)return d(t,0,1);for(var f,g,h="",i=0,j=a.length;j>i;i++){var k=a.charAt(i);if(":"!=k)h+=k;else{if(""==h||h!=(f=Number(h)))return d(t,0,1);if(g=a.substr(i+1,f),h!=g.length)return d(t,0,1);if(g.length){if(e=c.decodePacket(g,b,!0),t.type==e.type&&t.data==e.data)return d(t,0,1);var l=d(e,i+f,j);if(!1===l)return}i+=f,h=""}}return""!=h?d(t,0,1):void 0},c.encodePayloadAsArrayBuffer=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){return b(null,a)})}return a.length?void h(a,d,function(a,c){var d=c.reduce(function(a,b){var c;return c="string"==typeof b?b.length:b.byteLength,a+c.toString().length+c+2},0),e=new Uint8Array(d),f=0;return c.forEach(function(a){var b="string"==typeof a,c=a;if(b){for(var d=new Uint8Array(a.length),g=0;g<a.length;g++)d[g]=a.charCodeAt(g);c=d.buffer}b?e[f++]=0:e[f++]=1;for(var h=c.byteLength.toString(),g=0;g<h.length;g++)e[f++]=parseInt(h[g]);e[f++]=255;for(var d=new Uint8Array(c),g=0;g<d.length;g++)e[f++]=d[g]}),b(e.buffer)}):b(new ArrayBuffer(0))},c.encodePayloadAsBlob=function(a,b){function d(a,b){c.encodePacket(a,!0,!0,function(a){var c=new Uint8Array(1);if(c[0]=1,"string"==typeof a){for(var d=new Uint8Array(a.length),e=0;e<a.length;e++)d[e]=a.charCodeAt(e);a=d.buffer,c[0]=0}for(var f=a instanceof ArrayBuffer?a.byteLength:a.size,g=f.toString(),h=new Uint8Array(g.length+1),e=0;e<g.length;e++)h[e]=parseInt(g[e]);if(h[g.length]=255,u){var i=new u([c.buffer,h.buffer,a]);b(null,i)}})}h(a,d,function(a,c){return b(new u(c))})},c.decodePayloadAsBinary=function(a,b,d){"function"==typeof b&&(d=b,b=null);for(var e=a,f=[],g=!1;e.byteLength>0;){for(var h=new Uint8Array(e),i=0===h[0],j="",l=1;255!=h[l];l++){if(j.length>310){g=!0;break}j+=h[l]}if(g)return d(t,0,1);e=k(e,2+j.length),j=parseInt(j);var m=k(e,0,j);if(i)try{m=String.fromCharCode.apply(null,new Uint8Array(m))}catch(n){var o=new Uint8Array(m);m="";for(var l=0;l<o.length;l++)m+=String.fromCharCode(o[l])}f.push(m),e=k(e,j)}var p=f.length;f.forEach(function(a,e){d(c.decodePacket(a,b,!0),e,p)})}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./keys":20,after:11,"arraybuffer.slice":12,"base64-arraybuffer":13,blob:14,"has-binary":21,utf8:29}],20:[function(a,b,c){b.exports=Object.keys||function(a){var b=[],c=Object.prototype.hasOwnProperty;for(var d in a)c.call(a,d)&&b.push(d);return b}},{}],21:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&(a=a.toJSON());for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:24}],22:[function(a,b,c){try{b.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(d){b.exports=!1}},{}],23:[function(a,b,c){var d=[].indexOf;b.exports=function(a,b){if(d)return a.indexOf(b);for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}},{}],24:[function(a,b,c){b.exports=Array.isArray||function(a){return"[object Array]"==Object.prototype.toString.call(a)}},{}],25:[function(a,b,c){function d(a){if(a=""+a,!(a.length>1e4)){var b=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(a);if(b){var c=parseFloat(b[1]),d=(b[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*l;case"days":case"day":case"d":return c*k;case"hours":case"hour":case"hrs":case"hr":case"h":return c*j;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*h;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c}}}}function e(a){return a>=k?Math.round(a/k)+"d":a>=j?Math.round(a/j)+"h":a>=i?Math.round(a/i)+"m":a>=h?Math.round(a/h)+"s":a+"ms"}function f(a){return g(a,k,"day")||g(a,j,"hour")||g(a,i,"minute")||g(a,h,"second")||a+" ms"}function g(a,b,c){return b>a?void 0:1.5*b>a?Math.floor(a/b)+" "+c:Math.ceil(a/b)+" "+c+"s"}var h=1e3,i=60*h,j=60*i,k=24*j,l=365.25*k;b.exports=function(a,b){return b=b||{},"string"==typeof a?d(a):b["long"]?f(a):e(a)}},{}],26:[function(a,b,c){(function(a){var c=/^[\],:{}\s]*$/,d=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,e=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,f=/(?:^|:|,)(?:\s*\[)+/g,g=/^\s+/,h=/\s+$/;b.exports=function(b){return"string"==typeof b&&b?(b=b.replace(g,"").replace(h,""),a.JSON&&JSON.parse?JSON.parse(b):c.test(b.replace(d,"@").replace(e,"]").replace(f,""))?new Function("return "+b)():void 0):null}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],27:[function(a,b,c){c.encode=function(a){var b="";for(var c in a)a.hasOwnProperty(c)&&(b.length&&(b+="&"),b+=encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b},c.decode=function(a){for(var b={},c=a.split("&"),d=0,e=c.length;e>d;d++){var f=c[d].split("=");b[decodeURIComponent(f[0])]=decodeURIComponent(f[1])}return b}},{}],28:[function(a,b,c){var d=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];b.exports=function(a){var b=a,c=a.indexOf("["),f=a.indexOf("]");-1!=c&&-1!=f&&(a=a.substring(0,c)+a.substring(c,f).replace(/:/g,";")+a.substring(f,a.length));for(var g=d.exec(a||""),h={},i=14;i--;)h[e[i]]=g[i]||"";return-1!=c&&-1!=f&&(h.source=b,h.host=h.host.substring(1,h.host.length-1).replace(/;/g,":"),h.authority=h.authority.replace("[","").replace("]","").replace(/;/g,":"),h.ipv6uri=!0),h}},{}],29:[function(b,c,d){(function(b){!function(e){function f(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function g(a){for(var b,c=a.length,d=-1,e="";++d<c;)b=a[d],b>65535&&(b-=65536,e+=u(b>>>10&1023|55296),b=56320|1023&b),e+=u(b);return e}function h(a){if(a>=55296&&57343>=a)throw Error("Lone surrogate U+"+a.toString(16).toUpperCase()+" is not a scalar value")}function i(a,b){return u(a>>b&63|128)}function j(a){if(0==(4294967168&a))return u(a);var b="";return 0==(4294965248&a)?b=u(a>>6&31|192):0==(4294901760&a)?(h(a),b=u(a>>12&15|224),b+=i(a,6)):0==(4292870144&a)&&(b=u(a>>18&7|240),b+=i(a,12),b+=i(a,6)),b+=u(63&a|128)}function k(a){for(var b,c=f(a),d=c.length,e=-1,g="";++e<d;)b=c[e],g+=j(b);return g}function l(){if(t>=s)throw Error("Invalid byte index");var a=255&r[t];if(t++,128==(192&a))return 63&a;throw Error("Invalid continuation byte")}function m(){var a,b,c,d,e;if(t>s)throw Error("Invalid byte index");if(t==s)return!1;if(a=255&r[t],t++,0==(128&a))return a;if(192==(224&a)){var b=l();if(e=(31&a)<<6|b,e>=128)return e;throw Error("Invalid continuation byte")}if(224==(240&a)){if(b=l(),c=l(),e=(15&a)<<12|b<<6|c,e>=2048)return h(e),e;throw Error("Invalid continuation byte")}if(240==(248&a)&&(b=l(),c=l(),d=l(),e=(15&a)<<18|b<<12|c<<6|d,e>=65536&&1114111>=e))return e;throw Error("Invalid UTF-8 detected")}function n(a){r=f(a),s=r.length,t=0;for(var b,c=[];(b=m())!==!1;)c.push(b);return g(c)}var o="object"==typeof d&&d,p="object"==typeof c&&c&&c.exports==o&&c,q="object"==typeof b&&b;q.global!==q&&q.window!==q||(e=q);var r,s,t,u=String.fromCharCode,v={version:"2.0.0",encode:k,decode:n};if("function"==typeof a&&"object"==typeof a.amd&&a.amd)a(function(){return v});else if(o&&!o.nodeType)if(p)p.exports=v;else{var w={},x=w.hasOwnProperty;for(var y in v)x.call(v,y)&&(o[y]=v[y])}else e.utf8=v}(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],30:[function(a,b,c){"use strict";function d(a){var b="";do b=h[a%i]+b,a=Math.floor(a/i);while(a>0);return b}function e(a){var b=0;for(l=0;l<a.length;l++)b=b*i+j[a.charAt(l)];return b}function f(){var a=d(+new Date);return a!==g?(k=0,g=a):a+"."+d(k++)}for(var g,h="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,j={},k=0,l=0;i>l;l++)j[h[l]]=l;f.encode=d,f.decode=e,b.exports=f},{}],31:[function(a,b,c){function d(a,b){"object"==typeof a&&(b=a,a=void 0),b=b||{};var c,d=e(a),f=d.source,j=d.id,k=d.path,l=i[j]&&k in i[j].nsps,m=b.forceNew||b["force new connection"]||!1===b.multiplex||l;return m?(h("ignoring socket cache for %s",f),c=g(f,b)):(i[j]||(h("new io instance for %s",f),i[j]=g(f,b)),c=i[j]),c.socket(d.path)}var e=a("./url"),f=a("socket.io-parser"),g=a("./manager"),h=a("debug")("socket.io-client");b.exports=c=d;var i=c.managers={};c.protocol=f.protocol,c.connect=d,c.Manager=a("./manager"),c.Socket=a("./socket")},{"./manager":32,"./socket":34,"./url":35,debug:39,"socket.io-parser":47}],32:[function(a,b,c){function d(a,b){return this instanceof d?(a&&"object"==typeof a&&(b=a,a=void 0),b=b||{},b.path=b.path||"/socket.io",this.nsps={},this.subs=[],this.opts=b,this.reconnection(b.reconnection!==!1),this.reconnectionAttempts(b.reconnectionAttempts||1/0),this.reconnectionDelay(b.reconnectionDelay||1e3),this.reconnectionDelayMax(b.reconnectionDelayMax||5e3),this.randomizationFactor(b.randomizationFactor||.5),this.backoff=new m({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==b.timeout?2e4:b.timeout),this.readyState="closed",this.uri=a,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[],this.encoder=new h.Encoder,this.decoder=new h.Decoder,this.autoConnect=b.autoConnect!==!1,void(this.autoConnect&&this.open())):new d(a,b)}var e=a("engine.io-client"),f=a("./socket"),g=a("component-emitter"),h=a("socket.io-parser"),i=a("./on"),j=a("component-bind"),k=a("debug")("socket.io-client:manager"),l=a("indexof"),m=a("backo2"),n=Object.prototype.hasOwnProperty;b.exports=d,d.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var a in this.nsps)n.call(this.nsps,a)&&this.nsps[a].emit.apply(this.nsps[a],arguments)},d.prototype.updateSocketIds=function(){for(var a in this.nsps)n.call(this.nsps,a)&&(this.nsps[a].id=this.engine.id)},g(d.prototype),d.prototype.reconnection=function(a){return arguments.length?(this._reconnection=!!a,this):this._reconnection},d.prototype.reconnectionAttempts=function(a){return arguments.length?(this._reconnectionAttempts=a,this):this._reconnectionAttempts},d.prototype.reconnectionDelay=function(a){return arguments.length?(this._reconnectionDelay=a,this.backoff&&this.backoff.setMin(a),this):this._reconnectionDelay},d.prototype.randomizationFactor=function(a){return arguments.length?(this._randomizationFactor=a,this.backoff&&this.backoff.setJitter(a),this):this._randomizationFactor},d.prototype.reconnectionDelayMax=function(a){return arguments.length?(this._reconnectionDelayMax=a,this.backoff&&this.backoff.setMax(a),this):this._reconnectionDelayMax},d.prototype.timeout=function(a){return arguments.length?(this._timeout=a,this):this._timeout},d.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},d.prototype.open=d.prototype.connect=function(a){if(k("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;k("opening %s",this.uri),this.engine=e(this.uri,this.opts);var b=this.engine,c=this;this.readyState="opening",this.skipReconnect=!1;var d=i(b,"open",function(){c.onopen(),a&&a()}),f=i(b,"error",function(b){if(k("connect_error"),c.cleanup(),c.readyState="closed",c.emitAll("connect_error",b),a){var d=new Error("Connection error");d.data=b,a(d)}else c.maybeReconnectOnOpen()});if(!1!==this._timeout){var g=this._timeout;k("connect attempt will timeout after %d",g);var h=setTimeout(function(){k("connect attempt timed out after %d",g),d.destroy(),b.close(),b.emit("error","timeout"),c.emitAll("connect_timeout",g)},g);this.subs.push({destroy:function(){clearTimeout(h)}})}return this.subs.push(d),this.subs.push(f),this},d.prototype.onopen=function(){k("open"),this.cleanup(),this.readyState="open",this.emit("open");var a=this.engine;this.subs.push(i(a,"data",j(this,"ondata"))),this.subs.push(i(a,"ping",j(this,"onping"))),this.subs.push(i(a,"pong",j(this,"onpong"))),this.subs.push(i(a,"error",j(this,"onerror"))),this.subs.push(i(a,"close",j(this,"onclose"))),this.subs.push(i(this.decoder,"decoded",j(this,"ondecoded")))},d.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},d.prototype.onpong=function(){
this.emitAll("pong",new Date-this.lastPing)},d.prototype.ondata=function(a){this.decoder.add(a)},d.prototype.ondecoded=function(a){this.emit("packet",a)},d.prototype.onerror=function(a){k("error",a),this.emitAll("error",a)},d.prototype.socket=function(a){function b(){~l(d.connecting,c)||d.connecting.push(c)}var c=this.nsps[a];if(!c){c=new f(this,a),this.nsps[a]=c;var d=this;c.on("connecting",b),c.on("connect",function(){c.id=d.engine.id}),this.autoConnect&&b()}return c},d.prototype.destroy=function(a){var b=l(this.connecting,a);~b&&this.connecting.splice(b,1),this.connecting.length||this.close()},d.prototype.packet=function(a){k("writing packet %j",a);var b=this;b.encoding?b.packetBuffer.push(a):(b.encoding=!0,this.encoder.encode(a,function(c){for(var d=0;d<c.length;d++)b.engine.write(c[d],a.options);b.encoding=!1,b.processPacketQueue()}))},d.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var a=this.packetBuffer.shift();this.packet(a)}},d.prototype.cleanup=function(){k("cleanup");for(var a;a=this.subs.shift();)a.destroy();this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},d.prototype.close=d.prototype.disconnect=function(){k("disconnect"),this.skipReconnect=!0,this.reconnecting=!1,"opening"==this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},d.prototype.onclose=function(a){k("onclose"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",a),this._reconnection&&!this.skipReconnect&&this.reconnect()},d.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var a=this;if(this.backoff.attempts>=this._reconnectionAttempts)k("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var b=this.backoff.duration();k("will wait %dms before reconnect attempt",b),this.reconnecting=!0;var c=setTimeout(function(){a.skipReconnect||(k("attempting reconnect"),a.emitAll("reconnect_attempt",a.backoff.attempts),a.emitAll("reconnecting",a.backoff.attempts),a.skipReconnect||a.open(function(b){b?(k("reconnect attempt error"),a.reconnecting=!1,a.reconnect(),a.emitAll("reconnect_error",b.data)):(k("reconnect success"),a.onreconnect())}))},b);this.subs.push({destroy:function(){clearTimeout(c)}})}},d.prototype.onreconnect=function(){var a=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",a)}},{"./on":33,"./socket":34,backo2:36,"component-bind":37,"component-emitter":38,debug:39,"engine.io-client":1,indexof:42,"socket.io-parser":47}],33:[function(a,b,c){function d(a,b,c){return a.on(b,c),{destroy:function(){a.removeListener(b,c)}}}b.exports=d},{}],34:[function(a,b,c){function d(a,b){this.io=a,this.nsp=b,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.io.autoConnect&&this.open()}var e=a("socket.io-parser"),f=a("component-emitter"),g=a("to-array"),h=a("./on"),i=a("component-bind"),j=a("debug")("socket.io-client:socket"),k=a("has-binary");b.exports=c=d;var l={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},m=f.prototype.emit;f(d.prototype),d.prototype.subEvents=function(){if(!this.subs){var a=this.io;this.subs=[h(a,"open",i(this,"onopen")),h(a,"packet",i(this,"onpacket")),h(a,"close",i(this,"onclose"))]}},d.prototype.open=d.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this.emit("connecting"),this)},d.prototype.send=function(){var a=g(arguments);return a.unshift("message"),this.emit.apply(this,a),this},d.prototype.emit=function(a){if(l.hasOwnProperty(a))return m.apply(this,arguments),this;var b=g(arguments),c=e.EVENT;k(b)&&(c=e.BINARY_EVENT);var d={type:c,data:b};return d.options={},d.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof b[b.length-1]&&(j("emitting packet with ack id %d",this.ids),this.acks[this.ids]=b.pop(),d.id=this.ids++),this.connected?this.packet(d):this.sendBuffer.push(d),delete this.flags,this},d.prototype.packet=function(a){a.nsp=this.nsp,this.io.packet(a)},d.prototype.onopen=function(){j("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:e.CONNECT})},d.prototype.onclose=function(a){j("close (%s)",a),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",a)},d.prototype.onpacket=function(a){if(a.nsp==this.nsp)switch(a.type){case e.CONNECT:this.onconnect();break;case e.EVENT:this.onevent(a);break;case e.BINARY_EVENT:this.onevent(a);break;case e.ACK:this.onack(a);break;case e.BINARY_ACK:this.onack(a);break;case e.DISCONNECT:this.ondisconnect();break;case e.ERROR:this.emit("error",a.data)}},d.prototype.onevent=function(a){var b=a.data||[];j("emitting event %j",b),null!=a.id&&(j("attaching ack callback to event"),b.push(this.ack(a.id))),this.connected?m.apply(this,b):this.receiveBuffer.push(b)},d.prototype.ack=function(a){var b=this,c=!1;return function(){if(!c){c=!0;var d=g(arguments);j("sending ack %j",d);var f=k(d)?e.BINARY_ACK:e.ACK;b.packet({type:f,id:a,data:d})}}},d.prototype.onack=function(a){var b=this.acks[a.id];"function"==typeof b?(j("calling ack %s with %j",a.id,a.data),b.apply(this,a.data),delete this.acks[a.id]):j("bad ack %s",a.id)},d.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},d.prototype.emitBuffered=function(){var a;for(a=0;a<this.receiveBuffer.length;a++)m.apply(this,this.receiveBuffer[a]);for(this.receiveBuffer=[],a=0;a<this.sendBuffer.length;a++)this.packet(this.sendBuffer[a]);this.sendBuffer=[]},d.prototype.ondisconnect=function(){j("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},d.prototype.destroy=function(){if(this.subs){for(var a=0;a<this.subs.length;a++)this.subs[a].destroy();this.subs=null}this.io.destroy(this)},d.prototype.close=d.prototype.disconnect=function(){return this.connected&&(j("performing disconnect (%s)",this.nsp),this.packet({type:e.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},d.prototype.compress=function(a){return this.flags=this.flags||{},this.flags.compress=a,this}},{"./on":33,"component-bind":37,"component-emitter":38,debug:39,"has-binary":41,"socket.io-parser":47,"to-array":51}],35:[function(a,b,c){(function(c){function d(a,b){var d=a,b=b||c.location;null==a&&(a=b.protocol+"//"+b.host),"string"==typeof a&&("/"==a.charAt(0)&&(a="/"==a.charAt(1)?b.protocol+a:b.host+a),/^(https?|wss?):\/\//.test(a)||(f("protocol-less url %s",a),a="undefined"!=typeof b?b.protocol+"//"+a:"https://"+a),f("parse %s",a),d=e(a)),d.port||(/^(http|ws)$/.test(d.protocol)?d.port="80":/^(http|ws)s$/.test(d.protocol)&&(d.port="443")),d.path=d.path||"/";var g=-1!==d.host.indexOf(":"),h=g?"["+d.host+"]":d.host;return d.id=d.protocol+"://"+h+":"+d.port,d.href=d.protocol+"://"+h+(b&&b.port==d.port?"":":"+d.port),d}var e=a("parseuri"),f=a("debug")("socket.io-client:url");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{debug:39,parseuri:45}],36:[function(a,b,c){function d(a){a=a||{},this.ms=a.min||100,this.max=a.max||1e4,this.factor=a.factor||2,this.jitter=a.jitter>0&&a.jitter<=1?a.jitter:0,this.attempts=0}b.exports=d,d.prototype.duration=function(){var a=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var b=Math.random(),c=Math.floor(b*this.jitter*a);a=0==(1&Math.floor(10*b))?a-c:a+c}return 0|Math.min(a,this.max)},d.prototype.reset=function(){this.attempts=0},d.prototype.setMin=function(a){this.ms=a},d.prototype.setMax=function(a){this.max=a},d.prototype.setJitter=function(a){this.jitter=a}},{}],37:[function(a,b,c){var d=[].slice;b.exports=function(a,b){if("string"==typeof b&&(b=a[b]),"function"!=typeof b)throw new Error("bind() requires a function");var c=d.call(arguments,2);return function(){return b.apply(a,c.concat(d.call(arguments)))}}},{}],38:[function(a,b,c){function d(a){return a?e(a):void 0}function e(a){for(var b in d.prototype)a[b]=d.prototype[b];return a}b.exports=d,d.prototype.on=d.prototype.addEventListener=function(a,b){return this._callbacks=this._callbacks||{},(this._callbacks["$"+a]=this._callbacks["$"+a]||[]).push(b),this},d.prototype.once=function(a,b){function c(){this.off(a,c),b.apply(this,arguments)}return c.fn=b,this.on(a,c),this},d.prototype.off=d.prototype.removeListener=d.prototype.removeAllListeners=d.prototype.removeEventListener=function(a,b){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var c=this._callbacks["$"+a];if(!c)return this;if(1==arguments.length)return delete this._callbacks["$"+a],this;for(var d,e=0;e<c.length;e++)if(d=c[e],d===b||d.fn===b){c.splice(e,1);break}return this},d.prototype.emit=function(a){this._callbacks=this._callbacks||{};var b=[].slice.call(arguments,1),c=this._callbacks["$"+a];if(c){c=c.slice(0);for(var d=0,e=c.length;e>d;++d)c[d].apply(this,b)}return this},d.prototype.listeners=function(a){return this._callbacks=this._callbacks||{},this._callbacks["$"+a]||[]},d.prototype.hasListeners=function(a){return!!this.listeners(a).length}},{}],39:[function(a,b,c){arguments[4][17][0].apply(c,arguments)},{"./debug":40,dup:17}],40:[function(a,b,c){arguments[4][18][0].apply(c,arguments)},{dup:18,ms:44}],41:[function(a,b,c){(function(c){function d(a){function b(a){if(!a)return!1;if(c.Buffer&&c.Buffer.isBuffer&&c.Buffer.isBuffer(a)||c.ArrayBuffer&&a instanceof ArrayBuffer||c.Blob&&a instanceof Blob||c.File&&a instanceof File)return!0;if(e(a)){for(var d=0;d<a.length;d++)if(b(a[d]))return!0}else if(a&&"object"==typeof a){a.toJSON&&"function"==typeof a.toJSON&&(a=a.toJSON());for(var f in a)if(Object.prototype.hasOwnProperty.call(a,f)&&b(a[f]))return!0}return!1}return b(a)}var e=a("isarray");b.exports=d}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{isarray:43}],42:[function(a,b,c){arguments[4][23][0].apply(c,arguments)},{dup:23}],43:[function(a,b,c){arguments[4][24][0].apply(c,arguments)},{dup:24}],44:[function(a,b,c){arguments[4][25][0].apply(c,arguments)},{dup:25}],45:[function(a,b,c){arguments[4][28][0].apply(c,arguments)},{dup:28}],46:[function(a,b,c){(function(b){var d=a("isarray"),e=a("./is-buffer");c.deconstructPacket=function(a){function b(a){if(!a)return a;if(e(a)){var f={_placeholder:!0,num:c.length};return c.push(a),f}if(d(a)){for(var g=new Array(a.length),h=0;h<a.length;h++)g[h]=b(a[h]);return g}if("object"==typeof a&&!(a instanceof Date)){var g={};for(var i in a)g[i]=b(a[i]);return g}return a}var c=[],f=a.data,g=a;return g.data=b(f),g.attachments=c.length,{packet:g,buffers:c}},c.reconstructPacket=function(a,b){function c(a){if(a&&a._placeholder){var e=b[a.num];return e}if(d(a)){for(var f=0;f<a.length;f++)a[f]=c(a[f]);return a}if(a&&"object"==typeof a){for(var g in a)a[g]=c(a[g]);return a}return a}return a.data=c(a.data),a.attachments=void 0,a},c.removeBlobs=function(a,c){function f(a,i,j){if(!a)return a;if(b.Blob&&a instanceof Blob||b.File&&a instanceof File){g++;var k=new FileReader;k.onload=function(){j?j[i]=this.result:h=this.result,--g||c(h)},k.readAsArrayBuffer(a)}else if(d(a))for(var l=0;l<a.length;l++)f(a[l],l,a);else if(a&&"object"==typeof a&&!e(a))for(var m in a)f(a[m],m,a)}var g=0,h=a;f(h),g||c(h)}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{"./is-buffer":48,isarray:43}],47:[function(a,b,c){function d(){}function e(a){var b="",d=!1;return b+=a.type,c.BINARY_EVENT!=a.type&&c.BINARY_ACK!=a.type||(b+=a.attachments,b+="-"),a.nsp&&"/"!=a.nsp&&(d=!0,b+=a.nsp),null!=a.id&&(d&&(b+=",",d=!1),b+=a.id),null!=a.data&&(d&&(b+=","),b+=l.stringify(a.data)),k("encoded %j as %s",a,b),b}function f(a,b){function c(a){var c=n.deconstructPacket(a),d=e(c.packet),f=c.buffers;f.unshift(d),b(f)}n.removeBlobs(a,c)}function g(){this.reconstructor=null}function h(a){var b={},d=0;if(b.type=Number(a.charAt(0)),null==c.types[b.type])return j();if(c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type){for(var e="";"-"!=a.charAt(++d)&&(e+=a.charAt(d),d!=a.length););if(e!=Number(e)||"-"!=a.charAt(d))throw new Error("Illegal attachments");b.attachments=Number(e)}if("/"==a.charAt(d+1))for(b.nsp="";++d;){var f=a.charAt(d);if(","==f)break;if(b.nsp+=f,d==a.length)break}else b.nsp="/";var g=a.charAt(d+1);if(""!==g&&Number(g)==g){for(b.id="";++d;){var f=a.charAt(d);if(null==f||Number(f)!=f){--d;break}if(b.id+=a.charAt(d),d==a.length)break}b.id=Number(b.id)}if(a.charAt(++d))try{b.data=l.parse(a.substr(d))}catch(h){return j()}return k("decoded %s as %j",a,b),b}function i(a){this.reconPack=a,this.buffers=[]}function j(a){return{type:c.ERROR,data:"parser error"}}var k=a("debug")("socket.io-parser"),l=a("json3"),m=(a("isarray"),a("component-emitter")),n=a("./binary"),o=a("./is-buffer");c.protocol=4,c.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],c.CONNECT=0,c.DISCONNECT=1,c.EVENT=2,c.ACK=3,c.ERROR=4,c.BINARY_EVENT=5,c.BINARY_ACK=6,c.Encoder=d,c.Decoder=g,d.prototype.encode=function(a,b){if(k("encoding packet %j",a),c.BINARY_EVENT==a.type||c.BINARY_ACK==a.type)f(a,b);else{var d=e(a);b([d])}},m(g.prototype),g.prototype.add=function(a){var b;if("string"==typeof a)b=h(a),c.BINARY_EVENT==b.type||c.BINARY_ACK==b.type?(this.reconstructor=new i(b),0===this.reconstructor.reconPack.attachments&&this.emit("decoded",b)):this.emit("decoded",b);else{if(!o(a)&&!a.base64)throw new Error("Unknown type: "+a);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");b=this.reconstructor.takeBinaryData(a),b&&(this.reconstructor=null,this.emit("decoded",b))}},g.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},i.prototype.takeBinaryData=function(a){if(this.buffers.push(a),this.buffers.length==this.reconPack.attachments){var b=n.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),b}return null},i.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":46,"./is-buffer":48,"component-emitter":49,debug:39,isarray:43,json3:50}],48:[function(a,b,c){(function(a){function c(b){return a.Buffer&&a.Buffer.isBuffer(b)||a.ArrayBuffer&&b instanceof ArrayBuffer}b.exports=c}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],49:[function(a,b,c){arguments[4][15][0].apply(c,arguments)},{dup:15}],50:[function(b,c,d){(function(b){(function(){function e(a,b){function c(a){if(c[a]!==q)return c[a];var e;if("bug-string-char-index"==a)e="a"!="a"[0];else if("json"==a)e=c("json-stringify")&&c("json-parse");else{var g,h='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var i=b.stringify,k="function"==typeof i&&t;if(k){(g=function(){return 1}).toJSON=g;try{k="0"===i(0)&&"0"===i(new d)&&'""'==i(new f)&&i(s)===q&&i(q)===q&&i()===q&&"1"===i(g)&&"[1]"==i([g])&&"[null]"==i([q])&&"null"==i(null)&&"[null,null,null]"==i([q,s,null])&&i({a:[g,!0,!1,null,"\x00\b\n\f\r	"]})==h&&"1"===i(null,g)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new j(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new j(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new j(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new j(-1))}catch(l){k=!1}}e=k}if("json-parse"==a){var m=b.parse;if("function"==typeof m)try{if(0===m("0")&&!m(!1)){g=m(h);var n=5==g.a.length&&1===g.a[0];if(n){try{n=!m('"	"')}catch(l){}if(n)try{n=1!==m("01")}catch(l){}if(n)try{n=1!==m("1.")}catch(l){}}}}catch(l){n=!1}e=n}}return c[a]=!!e}a||(a=i.Object()),b||(b=i.Object());var d=a.Number||i.Number,f=a.String||i.String,h=a.Object||i.Object,j=a.Date||i.Date,k=a.SyntaxError||i.SyntaxError,l=a.TypeError||i.TypeError,m=a.Math||i.Math,n=a.JSON||i.JSON;"object"==typeof n&&n&&(b.stringify=n.stringify,b.parse=n.parse);var o,p,q,r=h.prototype,s=r.toString,t=new j(-0xc782b5b800cec);try{t=-109252==t.getUTCFullYear()&&0===t.getUTCMonth()&&1===t.getUTCDate()&&10==t.getUTCHours()&&37==t.getUTCMinutes()&&6==t.getUTCSeconds()&&708==t.getUTCMilliseconds()}catch(u){}if(!c("json")){var v="[object Function]",w="[object Date]",x="[object Number]",y="[object String]",z="[object Array]",A="[object Boolean]",B=c("bug-string-char-index");if(!t)var C=m.floor,D=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(a,b){return D[b]+365*(a-1970)+C((a-1969+(b=+(b>1)))/4)-C((a-1901+b)/100)+C((a-1601+b)/400)};if((o=r.hasOwnProperty)||(o=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=s?o=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,o=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,o.call(this,a)}),p=function(a,b){var c,d,e,f=0;(c=function(){this.valueOf=0}).prototype.valueOf=0,d=new c;for(e in d)o.call(d,e)&&f++;return c=d=null,f?p=2==f?function(a,b){var c,d={},e=s.call(a)==v;for(c in a)e&&"prototype"==c||o.call(d,c)||!(d[c]=1)||!o.call(a,c)||b(c)}:function(a,b){var c,d,e=s.call(a)==v;for(c in a)e&&"prototype"==c||!o.call(a,c)||(d="constructor"===c)||b(c);(d||o.call(a,c="constructor"))&&b(c)}:(d=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(a,b){var c,e,f=s.call(a)==v,h=!f&&"function"!=typeof a.constructor&&g[typeof a.hasOwnProperty]&&a.hasOwnProperty||o;for(c in a)f&&"prototype"==c||!h.call(a,c)||b(c);for(e=d.length;c=d[--e];h.call(a,c)&&b(c));}),p(a,b)},!c("json-stringify")){var F={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},G="000000",H=function(a,b){return(G+(b||0)).slice(-a)},I="\\u00",J=function(a){for(var b='"',c=0,d=a.length,e=!B||d>10,f=e&&(B?a.split(""):a);d>c;c++){var g=a.charCodeAt(c);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=F[g];break;default:if(32>g){b+=I+H(2,g.toString(16));break}b+=e?f[c]:a.charAt(c)}}return b+'"'},K=function(a,b,c,d,e,f,g){var h,i,j,k,m,n,r,t,u,v,B,D,F,G,I,L;try{h=b[a]}catch(M){}if("object"==typeof h&&h)if(i=s.call(h),i!=w||o.call(h,"toJSON"))"function"==typeof h.toJSON&&(i!=x&&i!=y&&i!=z||o.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&1/0>h){if(E){for(m=C(h/864e5),j=C(m/365.2425)+1970-1;E(j+1,0)<=m;j++);for(k=C((m-E(j,0))/30.42);E(j,k+1)<=m;k++);m=1+m-E(j,k),n=(h%864e5+864e5)%864e5,r=C(n/36e5)%24,t=C(n/6e4)%60,u=C(n/1e3)%60,v=n%1e3}else j=h.getUTCFullYear(),k=h.getUTCMonth(),m=h.getUTCDate(),r=h.getUTCHours(),t=h.getUTCMinutes(),u=h.getUTCSeconds(),v=h.getUTCMilliseconds();h=(0>=j||j>=1e4?(0>j?"-":"+")+H(6,0>j?-j:j):H(4,j))+"-"+H(2,k+1)+"-"+H(2,m)+"T"+H(2,r)+":"+H(2,t)+":"+H(2,u)+"."+H(3,v)+"Z"}else h=null;if(c&&(h=c.call(b,a,h)),null===h)return"null";if(i=s.call(h),i==A)return""+h;if(i==x)return h>-1/0&&1/0>h?""+h:"null";if(i==y)return J(""+h);if("object"==typeof h){for(G=g.length;G--;)if(g[G]===h)throw l();if(g.push(h),B=[],I=f,f+=e,i==z){for(F=0,G=h.length;G>F;F++)D=K(F,h,c,d,e,f,g),B.push(D===q?"null":D);L=B.length?e?"[\n"+f+B.join(",\n"+f)+"\n"+I+"]":"["+B.join(",")+"]":"[]"}else p(d||h,function(a){var b=K(a,h,c,d,e,f,g);b!==q&&B.push(J(a)+":"+(e?" ":"")+b)}),L=B.length?e?"{\n"+f+B.join(",\n"+f)+"\n"+I+"}":"{"+B.join(",")+"}":"{}";return g.pop(),L}};b.stringify=function(a,b,c){var d,e,f,h;if(g[typeof b]&&b)if((h=s.call(b))==v)e=b;else if(h==z){f={};for(var i,j=0,k=b.length;k>j;i=b[j++],h=s.call(i),(h==y||h==x)&&(f[i]=1));}if(c)if((h=s.call(c))==x){if((c-=c%1)>0)for(d="",c>10&&(c=10);d.length<c;d+=" ");}else h==y&&(d=c.length<=10?c:c.slice(0,10));return K("",(i={},i[""]=a,i),e,f,d,"",[])}}if(!c("json-parse")){var L,M,N=f.fromCharCode,O={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},P=function(){throw L=M=null,k()},Q=function(){for(var a,b,c,d,e,f=M,g=f.length;g>L;)switch(e=f.charCodeAt(L)){case 9:case 10:case 13:case 32:L++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=B?f.charAt(L):f[L],L++,a;case 34:for(a="@",L++;g>L;)if(e=f.charCodeAt(L),32>e)P();else if(92==e)switch(e=f.charCodeAt(++L)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=O[e],L++;break;case 117:for(b=++L,c=L+4;c>L;L++)e=f.charCodeAt(L),e>=48&&57>=e||e>=97&&102>=e||e>=65&&70>=e||P();a+=N("0x"+f.slice(b,L));break;default:P()}else{if(34==e)break;for(e=f.charCodeAt(L),b=L;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++L);a+=f.slice(b,L)}if(34==f.charCodeAt(L))return L++,a;P();default:if(b=L,45==e&&(d=!0,e=f.charCodeAt(++L)),e>=48&&57>=e){for(48==e&&(e=f.charCodeAt(L+1),e>=48&&57>=e)&&P(),d=!1;g>L&&(e=f.charCodeAt(L),e>=48&&57>=e);L++);if(46==f.charCodeAt(L)){for(c=++L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}if(e=f.charCodeAt(L),101==e||69==e){for(e=f.charCodeAt(++L),43!=e&&45!=e||L++,c=L;g>c&&(e=f.charCodeAt(c),e>=48&&57>=e);c++);c==L&&P(),L=c}return+f.slice(b,L)}if(d&&P(),"true"==f.slice(L,L+4))return L+=4,!0;if("false"==f.slice(L,L+5))return L+=5,!1;if("null"==f.slice(L,L+4))return L+=4,null;P()}return"$"},R=function(a){var b,c;if("$"==a&&P(),"string"==typeof a){if("@"==(B?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];a=Q(),"]"!=a;c||(c=!0))c&&(","==a?(a=Q(),"]"==a&&P()):P()),","==a&&P(),b.push(R(a));return b}if("{"==a){for(b={};a=Q(),"}"!=a;c||(c=!0))c&&(","==a?(a=Q(),"}"==a&&P()):P()),","!=a&&"string"==typeof a&&"@"==(B?a.charAt(0):a[0])&&":"==Q()||P(),b[a.slice(1)]=R(Q());return b}P()}return a},S=function(a,b,c){var d=T(a,b,c);d===q?delete a[b]:a[b]=d},T=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(s.call(e)==z)for(d=e.length;d--;)S(e,d,c);else p(e,function(a){S(e,a,c)});return c.call(a,b,e)};b.parse=function(a,b){var c,d;return L=0,M=""+a,c=R(Q()),"$"!=Q()&&P(),L=M=null,b&&s.call(b)==v?T((d={},d[""]=c,d),"",b):c}}}return b.runInContext=e,b}var f="function"==typeof a&&a.amd,g={"function":!0,object:!0},h=g[typeof d]&&d&&!d.nodeType&&d,i=g[typeof window]&&window||this,j=h&&g[typeof c]&&c&&!c.nodeType&&"object"==typeof b&&b;if(!j||j.global!==j&&j.window!==j&&j.self!==j||(i=j),h&&!f)e(i,h);else{var k=i.JSON,l=i.JSON3,m=!1,n=e(i,i.JSON3={noConflict:function(){return m||(m=!0,i.JSON=k,i.JSON3=l,k=l=null),n}});i.JSON={parse:n.parse,stringify:n.stringify}}f&&a(function(){return n})}).call(this)}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{})},{}],51:[function(a,b,c){function d(a,b){var c=[];b=b||0;for(var d=b||0;d<a.length;d++)c[d-b]=a[d];return c}b.exports=d},{}]},{},[31])(31)}),CB.CloudApp=CB.CloudApp||{},CB.CloudApp._isConnected=!1,CB.CloudApp.init=function(a,b,c,d){c?CB.apiUrl=a:(c=b,b=a),"object"==typeof c&&(d=c,c=b,b=a),CB.appId=b,CB.appKey=c,d&&d.disableRealtime===!0?CB._isRealtimeDisabled=!0:(CB._isNode?CB.io=require("socket.io-client"):CB.io=io,CB.Socket=CB.io(CB.apiUrl)),CB.CloudApp._isConnected=!0},CB.CloudApp.onConnect=function(a){if(CB._validate(),!CB.Socket)throw"Socket couldn't be found. Init app first.";CB.Socket.on("connect",a)},CB.CloudApp.onDisconnect=function(a){if(CB._validate(),!CB.Socket)throw"Socket couldn't be found. Init app first.";CB.Socket.on("disconnect",a)},CB.CloudApp.connect=function(){if(CB._validate(),!CB.Socket)throw"Socket couldn't be found. Init app first.";CB.Socket.connect(),CB.CloudApp._isConnected=!0},CB.CloudApp.disconnect=function(){if(CB._validate(),!CB.Socket)throw"Socket couldn't be found. Init app first.";CB.Socket.emit("socket-disconnect",CB.appId),CB.CloudApp._isConnected=!1},CB.ACL=function(){this.document={},this.document.read={allow:{user:["all"],role:[]},deny:{user:[],role:[]}},this.document.write={allow:{user:["all"],role:[]},deny:{user:[],role:[]}},this.parent=null},CB.ACL.prototype.setPublicWriteAccess=function(a){if(a)this.document.write.allow.user=["all"];else{var b=this.document.write.allow.user.indexOf("all");b>-1&&this.document.write.allow.user.splice(b,1)}this.parent&&CB._modified(this.parent,"ACL")},CB.ACL.prototype.setPublicReadAccess=function(a){if(a)this.document.read.allow.user=["all"];else{var b=this.document.read.allow.user.indexOf("all");b>-1&&this.document.read.allow.user.splice(b,1)}this.parent&&CB._modified(this.parent,"ACL")},CB.ACL.prototype.setUserWriteAccess=function(a,b){if(b){var c=this.document.write.allow.user.indexOf("all");c>-1&&this.document.write.allow.user.splice(c,1),-1===this.document.write.allow.user.indexOf(a)&&this.document.write.allow.user.push(a)}else{var c=this.document.write.allow.user.indexOf(a);c>-1&&this.document.write.allow.user.splice(c,1),this.document.write.deny.user.push(a)}this.parent&&CB._modified(this.parent,"ACL")},CB.ACL.prototype.setUserReadAccess=function(a,b){if(b){var c=this.document.read.allow.user.indexOf("all");c>-1&&this.document.read.allow.user.splice(c,1),-1===this.document.read.allow.user.indexOf(a)&&this.document.read.allow.user.push(a)}else{var c=this.document.read.allow.user.indexOf(a);c>-1&&this.document.read.allow.user.splice(c,1),this.document.read.deny.user.push(a)}this.parent&&CB._modified(this.parent,"ACL")},CB.ACL.prototype.setRoleWriteAccess=function(a,b){if(b){var c=this.document.write.allow.user.indexOf("all");c>-1&&this.document.write.allow.user.splice(c,1),-1===this.document.write.allow.role.indexOf(a)&&this.document.write.allow.role.push(a)}else{var c=this.document.write.allow.role.indexOf(a);c>-1&&this.document.write.allow.role.splice(c,1);var c=this.document.write.allow.user.indexOf("all");c>-1&&this.document.write.allow.user.splice(c,1),this.document.write.deny.role.push(a)}this.parent&&CB._modified(this.parent,"ACL")},CB.ACL.prototype.setRoleReadAccess=function(a,b){if(b){var c=this.document.read.allow.user.indexOf("all");c>-1&&this.document.read.allow.user.splice(c,1),-1===this.document.read.allow.role.indexOf(a)&&this.document.read.allow.role.push(a)}else{var c=this.document.read.allow.role.indexOf(a);c>-1&&this.document.read.allow.role.splice(c,1);var c=this.document.read.allow.user.indexOf("all");c>-1&&this.document.read.allow.user.splice(c,1),this.document.read.deny.role.push(a)}this.parent&&CB._modified(this.parent,"ACL")},CB.CloudNotification=CB.CloudNotification||{},CB.CloudNotification.on=function(a,b,c){if(CB._isRealtimeDisabled)throw"Realtime is disbaled for this app.";CB._validate();var d;return c||(d=new CB.Promise),CB.Socket.emit("join-custom-channel",CB.appId+a),CB.Socket.on(CB.appId+a,function(a){b(a)}),c&&c.success?c.success():d.resolve(),c?void 0:d},CB.CloudNotification.off=function(a,b){if(CB._isRealtimeDisabled)throw"Realtime is disbaled for this app.";CB._validate();var c;return b||(c=new CB.Promise),CB.Socket.emit("leave-custom-channel",CB.appId+a),CB.Socket.removeAllListeners(CB.appId+a),b&&b.success?b.success():c.resolve(),b?void 0:c},CB.CloudNotification.publish=function(a,b,c){if(CB._isRealtimeDisabled)throw"Realtime is disbaled for this app.";CB._validate();var d;return c||(d=new CB.Promise),CB.Socket.emit("publish-custom-channel",{channel:CB.appId+a,data:b}),c&&c.success?c.success():d.resolve(),c?void 0:d},CB.CloudObject=function(a,b){this.document={},this.document._tableName=a,this.document.ACL=new CB.ACL,this.document._type="custom",this.document.expires=null,this.document._hash=CB._generateHash(),b?(this.document._modifiedColumns=[],this.document._isModified=!1,this.document._id=b):(this.document._modifiedColumns=["createdAt","updatedAt","ACL","expires"],this.document._isModified=!0)},Object.defineProperty(CB.CloudObject.prototype,"ACL",{get:function(){return this.document.ACL},set:function(a){this.document.ACL=a,this.document.ACL.parent=this,CB._modified(this,"ACL")}}),Object.defineProperty(CB.CloudObject.prototype,"id",{get:function(){return this.document._id}}),Object.defineProperty(CB.CloudObject.prototype,"createdAt",{get:function(){return this.document.createdAt},set:function(a){this.document.createdAt=a,CB._modified(this,"createdAt")}}),Object.defineProperty(CB.CloudObject.prototype,"updatedAt",{get:function(){return this.document.updatedAt},set:function(a){this.document.updatedAt=a,CB._modified(this,"updatedAt")}}),Object.defineProperty(CB.CloudObject.prototype,"expires",{get:function(){return this.document.expires},set:function(a){this.document.expires=a,CB._modified(this,"expires")}}),CB.CloudObject.on=function(a,b,c,d,e){if(CB._isRealtimeDisabled)throw"Realtime is disbaled for this app.";var f;if(!c||c instanceof CB.CloudQuery||(null!==d&&"object"==typeof d&&(e=d,d=null),d=c,c=null),e||(f=new CB.Promise),c&&c instanceof CB.CloudQuery){if(c.tableName!==a)throw"CloudQuery TableName and CloudNotification TableName should be same.";if(c.query&&c.query.$include.length>0)throw"Include with CloudNotificaitons is not supported right now.";if(Object.keys(c.select).length>0)throw"You cannot pass the query with select in CloudNotifications."}if(a=a.toLowerCase(),b instanceof Array)for(var g=0;g<b.length;g++)CB.CloudObject.on(a,b[g],c,d),e&&e.success?e.success():f.resolve();else{if(b=b.toLowerCase(),"created"!==b&&"updated"!==b&&"deleted"!==b)throw"created, updated, deleted are supported notification types.";var h={room:(CB.appId+"table"+a+b).toLowerCase(),sessionId:CB._getSessionId()};CB.Socket.emit("join-object-channel",h),CB.Socket.on((CB.appId+"table"+a+b).toLowerCase(),function(a){a=CB.fromJSON(a),c&&c instanceof CB.CloudQuery&&CB.CloudObject._validateNotificationQuery(a,c)?d(a):c||d(a)}),e&&e.success?e.success():f.resolve()}return e?void 0:f},CB.CloudObject.off=function(a,b,c){if(CB._isRealtimeDisabled)throw"Realtime is disbaled for this app.";var d;if(c||(d=new CB.Promise),a=a.toLowerCase(),b instanceof Array)for(var e=0;e<b.length;e++)CB.CloudObject.off(a,b[e]),c&&c.success?c.success():d.resolve();else{if(b=b.toLowerCase(),"created"!==b&&"updated"!==b&&"deleted"!==b)throw"created, updated, deleted are supported notification types.";CB.Socket.emit("leave-object-channel",(CB.appId+"table"+a+b).toLowerCase()),CB.Socket.removeAllListeners((CB.appId+"table"+a+b).toLowerCase()),c&&c.success?c.success():d.resolve()}return c?void 0:d},CB.CloudObject.prototype.set=function(a,b){var c=["_tableName","_type","operator"];if("id"===a||"_id"===a)throw"You cannot set the id of a CloudObject";if("id"===a&&(a="_"+a),c.indexOf(a)>-1)throw a+" is a keyword. Please choose a different column name.";this.document[a]=b,CB._modified(this,a)},CB.CloudObject.prototype.relate=function(a,b,c){var d=["_tableName","_type","operator"];if("id"===a||"_id"===a)throw"You cannot set the id of a CloudObject";if("id"===a)throw"You cannot link an object to this column";if(d.indexOf(a)>-1)throw a+" is a keyword. Please choose a different column name.";this.document[a]=new CB.CloudObject(b,c),CB._modified(this,a)},CB.CloudObject.prototype.get=function(a){return"id"===a&&(a="_"+a),this.document[a]},CB.CloudObject.prototype.unset=function(a){this.document[a]=null,CB._modified(this,a)},CB.CloudObject.prototype.save=function(a){var b;CB._validate(),a||(b=new CB.Promise);return CB._fileCheck(this).then(function(c){var d=(CB._loadXml(),JSON.stringify({document:CB.toJSON(c),key:CB.appKey})),e=CB.apiUrl+"/data/"+CB.appId+"/"+c.document._tableName;CB._request("PUT",e,d).then(function(d){c=CB.fromJSON(JSON.parse(d),c),a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)})},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudObject.prototype.fetch=function(a){if(!CB.appId)throw"CB.appId is null.";if(!this.document._id)throw"Can't fetch an object which is not saved.";var b,c=this;a||(b=new CB.Promise);var d=null;return d="file"===c.document._type?new CB.CloudQuery("_File"):new CB.CloudQuery(c.document._tableName),d.findById(c.get("id")).then(function(c){a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudObject.prototype["delete"]=function(a){if(!CB.appId)throw"CB.appId is null.";
if(!this.document._id)throw"You cannot delete an object which is not saved.";var b,c=this;a||(b=new CB.Promise);var d=JSON.stringify({key:CB.appKey,document:CB.toJSON(c),method:"DELETE"}),e=CB.apiUrl+"/data/"+CB.appId+"/"+c.document._tableName;return CB._request("PUT",e,d).then(function(c){a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudObject.saveAll=function(a,b){if(!a||a.constructor!==Array)throw"Array of CloudObjects is Null";for(var c=0;c<a.length;c++)if(!(a[c]instanceof CB.CloudObject))throw"Should Be an Array of CloudObjects";var d;return b||(d=new CB.Promise),CB._bulkObjFileCheck(a).then(function(){var c=(CB._loadXml(),JSON.stringify({document:CB.toJSON(a),key:CB.appKey})),e=CB.apiUrl+"/data/"+CB.appId+"/"+a[0]._tableName;CB._request("PUT",e,c).then(function(a){var c=CB.fromJSON(JSON.parse(a));b?b.success(c):d.resolve(c)},function(a){b?b.error(a):d.reject(a)})},function(a){b?b.error(a):d.reject(a)}),b?void 0:d},CB.CloudObject.deleteAll=function(a,b){if(!a&&a.constructor!==Array)throw"Array of CloudObjects is Null";for(var c=0;c<a.length;c++)if(!(a[c]instanceof CB.CloudObject))throw"Should Be an Array of CloudObjects";var d;b||(d=new CB.Promise);var e=(CB._loadXml(),JSON.stringify({document:CB.toJSON(a),key:CB.appKey,method:"DELETE"})),f=CB.apiUrl+"/data/"+CB.appId+"/"+a[0]._tableName;return CB._request("PUT",f,e).then(function(a){var c=CB.fromJSON(JSON.parse(a));b?b.success(c):d.resolve(c)},function(a){b?b.error(a):d.reject(a)}),b?void 0:d},CB.CloudObject._validateNotificationQuery=function(a,b){if(!b)throw"CloudQuery is null";if(!b.query)throw"There is no query in CloudQuery";var c=b.query;return 0===b.limit?!1:b.skip>0?(--b.skip,!1):(delete c.$include,CB.CloudQuery._validateQuery(a,c)?(--b.limit,!0):!1)},CB.CloudQuery=function(a){if(!a)throw"Table Name cannot be null";this.tableName=a,this.query={},this.query.$include=[],this.query.$includeList=[],this.select={},this.sort={},this.skip=0,this.limit=10},CB.CloudQuery.or=function(a,b){if(!a.tableName===b.tableName)throw"Table names are not same";var c=new CB.CloudQuery(a.tableName);return c.query.$or=[a.query,b.query],c},CB.CloudQuery.prototype.equalTo=function(a,b){return"id"===a&&(a="_"+a),null!==b?(b.constructor===CB.CloudObject&&(a+="._id",b=b.get("id")),this.query[a]=b):this.doesNotExists(a),this},CB.CloudQuery.prototype.includeList=function(a){return"id"===a&&(a="_"+a),this.query.$includeList.push(a),this},CB.CloudQuery.prototype.include=function(a){return"id"===a&&(a="_"+a),this.query.$include.push(a),this},CB.CloudQuery.prototype.all=function(a){return"id"===a&&(a="_"+a),this.query.$all=a,this},CB.CloudQuery.prototype.any=function(a){return"id"===a&&(a="_"+a),this.query.$any=a,this},CB.CloudQuery.prototype.first=function(a){return"id"===a&&(a="_"+a),this.query.$first=a,this},CB.CloudQuery.prototype.notEqualTo=function(a,b){return"id"===a&&(a="_"+a),null!==b?(b.constructor===CB.CloudObject&&(a+="._id",b=b.get("id")),this.query[a]={$ne:b}):this.exists(a),this},CB.CloudQuery.prototype.greaterThan=function(a,b){return"id"===a&&(a="_"+a),this.query[a]||(this.query[a]={}),this.query[a].$gt=b,this},CB.CloudQuery.prototype.greaterThanEqualTo=function(a,b){return"id"===a&&(a="_"+a),this.query[a]||(this.query[a]={}),this.query[a].$gte=b,this},CB.CloudQuery.prototype.lessThan=function(a,b){return"id"===a&&(a="_"+a),this.query[a]||(this.query[a]={}),this.query[a].$lt=b,this},CB.CloudQuery.prototype.lessThanEqualTo=function(a,b){return"id"===a&&(a="_"+a),this.query[a]||(this.query[a]={}),this.query[a].$lte=b,this},CB.CloudQuery.prototype.orderByAsc=function(a){return"id"===a&&(a="_"+a),this.sort[a]=1,this},CB.CloudQuery.prototype.orderByDesc=function(a){return"id"===a&&(a="_"+a),this.sort[a]=-1,this},CB.CloudQuery.prototype.setLimit=function(a){return this.limit=a,this},CB.CloudQuery.prototype.setSkip=function(a){return this.skip=a,this},CB.CloudQuery.prototype.paginate=function(a,b,c){if(!CB.appId)throw"CB.appId is null.";if(!this.tableName)throw"TableName is null.";var d,c;if("object"==typeof c&&"function"==typeof c.success&&(c=c),c||(d=new CB.Promise),a&&"object"==typeof a&&"function"==typeof a.success&&(c=a,a=null),b&&"object"==typeof b&&"function"==typeof b.success&&(c=b,b=null),a&&"number"==typeof a&&a>0&&"number"==typeof b&&b>0){var e=a*b-b;this.setSkip(e),this.setLimit(b)}b&&"number"==typeof b&&b>0&&this.setLimit(b);var f=this,g=[];g.push(this.find());var h=Object.create(this);return h.setSkip(0),h.setLimit(99999999),g.push(h.count()),CB.Promise.all(g).then(function(a){var b=null,e=null,g=0;a&&a.length>0&&(b=a[0],e=a[1],e?g=Math.ceil(e/f.limit):(e=0,g=0),g&&0>g&&(g=0)),c?c.success(b,e,g):d.resolve(b,e,g)},function(a){c?c.error(a):d.reject(a)}),c?void 0:d},CB.CloudQuery.prototype.selectColumn=function(a){if(0===Object.keys(this.select).length&&(this.select={_id:1,createdAt:1,updatedAt:1,ACL:1,_type:1,_tableName:1}),"[object Object]"===Object.prototype.toString.call(a))this.select=a;else if("[object Array]"===Object.prototype.toString.call(a))for(var b=0;b<a.length;b++)this.select[a[b]]=1;else this.select[a]=1;return this},CB.CloudQuery.prototype.doNotSelectColumn=function(a){if("[object Object]"===Object.prototype.toString.call(a))this.select=a;else if("[object Array]"===Object.prototype.toString.call(a))for(var b=0;b<a.length;b++)this.select[a[b]]=0;else this.select[a]=0;return this},CB.CloudQuery.prototype.containedIn=function(a,b){var c=!1,d=[];if("id"===a&&(a="_"+a),"[object Object]"===Object.prototype.toString.call(b)&&!b instanceof CB.CloudObject)throw"Array / value / CloudObject expected as an argument";if("[object Array]"===Object.prototype.toString.call(b)){for(var e=0;e<b.length;e++)if(b[e]instanceof CB.CloudObject){if(c=!0,!b[e].id)throw"CloudObject passed should be saved and should have an id before being passed to containedIn";d.push(b[e].id)}0===d.length&&(d=b),c&&(a+="._id"),this.query[a]||(this.query[a]={}),this.query[a].$in=d,thisObj=this,"undefined"!=typeof this.query[a].$nin&&d.forEach(function(b){(index=thisObj.query[a].$nin.indexOf(b))>=0&&thisObj.query[a].$nin.splice(index,1)})}else{if(b instanceof CB.CloudObject){if(!b.id)throw"CloudObject passed should be saved and should have an id before being passed to containedIn";a+="._id",d=b.id}else d=b;this.query[a]||(this.query[a]={}),this.query[a].$in||(this.query[a].$in=[]),-1===this.query[a].$in.indexOf(d)&&this.query[a].$in.push(d),"undefined"!=typeof this.query[a].$nin&&(index=this.query[a].$nin.indexOf(d))>=0&&this.query[a].$nin.splice(index,1)}return this},CB.CloudQuery.prototype.notContainedIn=function(a,b){var c=!1,d=[];if("id"===a&&(a="_"+a),"[object Object]"===Object.prototype.toString.call(b)&&!b instanceof CB.CloudObject)throw"Array or string expected as an argument";if("[object Array]"===Object.prototype.toString.call(b)){for(var e=0;e<b.length;e++)if(b[e]instanceof CB.CloudObject){if(c=!0,!b[e].id)throw"CloudObject passed should be saved and should have an id before being passed to notContainedIn";d.push(b[e].id)}0===d.length&&(d=b),c&&(a+="._id"),this.query[a]||(this.query[a]={}),this.query[a].$nin=d,"undefined"!=typeof this.query[a].$in&&(thisObj=this,d.forEach(function(b){(index=thisObj.query[a].$in.indexOf(b))>=0&&thisObj.query[a].$in.splice(index,1)}))}else{if(b instanceof CB.CloudObject){if(!b.id)throw"CloudObject passed should be saved and should have an id before being passed to notContainedIn";a+="._id",d=b.id}else d=b;this.query[a]||(this.query[a]={}),this.query[a].$nin||(this.query[a].$nin=[]),-1===this.query[a].$nin.indexOf(d)&&this.query[a].$nin.push(d),"undefined"!=typeof this.query[a].$in&&(index=this.query[a].$in.indexOf(d))>=0&&this.query[a].$in.splice(index,1)}return this},CB.CloudQuery.prototype.exists=function(a){return"id"===a&&(a="_"+a),this.query[a]||(this.query[a]={}),this.query[a].$exists=!0,this},CB.CloudQuery.prototype.doesNotExists=function(a){return"id"===a&&(a="_"+a),this.query[a]||(this.query[a]={}),this.query[a].$exists=!1,this},CB.CloudQuery.prototype.containsAll=function(a,b){var c=!1,d=[];if("id"===a&&(a="_"+a),"[object Object]"===Object.prototype.toString.call(b)&&!b instanceof CB.CloudObject)throw"Array or string expected as an argument";if("[object Array]"===Object.prototype.toString.call(b)){for(var e=0;e<b.length;e++)if(b[e]instanceof CB.CloudObject){if(c=!0,!b[e].id)throw"CloudObject passed should be saved and should have an id before being passed to containsAll";d.push(b[e].id)}0===d.length&&(d=b),c&&(a+="._id"),this.query[a]||(this.query[a]={}),this.query[a].$all=d}else{if(b instanceof CB.CloudObject){if(!b.id)throw"CloudObject passed should be saved and should have an id before being passed to containsAll";a+="._id",d=b.id}else d=b;this.query[a]||(this.query[a]={}),this.query[a].$all||(this.query[a].$all=[]),-1===this.query[a].$all.indexOf(d)&&this.query[a].$all.push(d)}return this},CB.CloudQuery.prototype.startsWith=function(a,b){"id"===a&&(a="_"+a);var c="^"+b;return this.query[a]||(this.query[a]={}),this.query[a].$regex=c,this.query[a].$options="im",this},CB.CloudQuery.prototype.regex=function(a,b){return"id"===a&&(a="_"+a),this.query[a]||(this.query[a]={}),this.query[a].$regex=b,this},CB.CloudQuery.prototype.substring=function(a,b){"string"==typeof a&&(a=[a]);for(var c=0;c<a.length;c++)if("[object Array]"===Object.prototype.toString.call(b)&&b.length>0)for(this.query.$or||(this.query.$or=[]),i=0;i<b.length;i++){var d={};d[a[c]]={},d[a[c]].$regex=".*"+b[i]+".*",this.query.$or.push(d)}else if(1===a.length)this.regex(a[c],".*"+b+".*");else{this.query.$or||(this.query.$or=[]);var d={};d[a[c]]={},d[a[c]].$regex=".*"+b+".*",this.query.$or.push(d)}return this},CB.CloudQuery.prototype.near=function(a,b,c,d){this.query[a]||(this.query[a]={},this.query[a].$near={$geometry:{coordinates:b.document.coordinates,type:"Point"},$maxDistance:c,$minDistance:d})},CB.CloudQuery.prototype.geoWithin=function(a,b,c){if(c)this.query[a]||(this.query[a]={},this.query[a].$geoWithin={$centerSphere:[b.document.coordinates,c/3963.2]});else{var d=[];if("[object Array]"!==Object.prototype.toString.call(b))throw"Invalid Parameter, coordinates should be an array of CloudGeoPoint Object";for(i=0;i<b.length;i++)b[i].document.hasOwnProperty("coordinates")&&(d[i]=b[i].document.coordinates);d[d.length]=d[0];var e="Polygon";this.query[a]||(this.query[a]={},this.query[a].$geoWithin={},this.query[a].$geoWithin.$geometry={type:e,coordinates:[d]})}},CB.CloudQuery.prototype.count=function(a){if(!CB.appId)throw"CB.appId is null.";if(!this.tableName)throw"TableName is null.";var b;a||(b=new CB.Promise);var c=this,d=JSON.stringify({query:c.query,limit:c.limit,skip:c.skip,key:CB.appKey}),e=CB.apiUrl+"/data/"+CB.appId+"/"+c.tableName+"/count";return CB._request("POST",e,d).then(function(c){c=parseInt(c),a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudQuery.prototype.distinct=function(a,b){if("id"===a&&(a="_id"),!CB.appId)throw"CB.appId is null.";if(!this.tableName)throw"TableName is null.";if("[object Array]"!==Object.prototype.toString.call(a)&&a.length<=0)throw"keys should be array";var c;b||(c=new CB.Promise);var d=this,e=JSON.stringify({onKey:a,query:d.query,select:d.select,sort:d.sort,limit:d.limit,skip:d.skip,key:CB.appKey});return url=CB.apiUrl+"/data/"+CB.appId+"/"+d.tableName+"/distinct",CB._request("POST",url,e).then(function(a){var d=CB.fromJSON(JSON.parse(a));b?b.success(d):c.resolve(d)},function(a){b?b.error(a):c.reject(a)}),b?void 0:c},CB.CloudQuery.prototype.find=function(a){if(!CB.appId)throw"CB.appId is null.";if(!this.tableName)throw"TableName is null.";var b;a||(b=new CB.Promise);var c=this,d=(CB._loadXml(),JSON.stringify({query:c.query,select:c.select,sort:c.sort,limit:c.limit,skip:c.skip,key:CB.appKey}));return url=CB.apiUrl+"/data/"+CB.appId+"/"+c.tableName+"/find",CB._request("POST",url,d).then(function(c){var d=CB.fromJSON(JSON.parse(c));a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudQuery.prototype.get=function(a,b){var c=new CB.CloudQuery(this.tableName);return c.findById(a,b)},CB.CloudQuery.prototype.findById=function(a,b){var c=this;if(!CB.appId)throw"CB.appId is null.";if(!this.tableName)throw"TableName is null.";var d;if(b||(d=new CB.Promise),c.skip&&0!==!c.skip)throw"You cannot use skip and find object by Id in the same query";if(c.limit&&0===c.limit)throw"You cannot use limit and find object by Id in the same query";if(c.sort&&Object.getOwnPropertyNames(c.sort).length>0)throw"You cannot use sort and find object by Id in the same query";c.equalTo("id",a);var e=JSON.stringify({query:c.query,select:c.select,key:CB.appKey,limit:1,skip:0,sort:{}}),f=CB.apiUrl+"/data/"+CB.appId+"/"+c.tableName+"/find";return CB._request("POST",f,e).then(function(a){a=JSON.parse(a),"[object Array]"===Object.prototype.toString.call(a)&&(a=a[0]),b?b.success(CB.fromJSON(a)):d.resolve(CB.fromJSON(a))},function(a){b?b.error(a):d.reject(a)}),b?void 0:d},CB.CloudQuery.prototype.findOne=function(a){if(!CB.appId)throw"CB.appId is null.";if(!this.tableName)throw"TableName is null.";var b;a||(b=new CB.Promise);var c=JSON.stringify({query:this.query,select:this.select,sort:this.sort,skip:this.skip,key:CB.appKey});return url=CB.apiUrl+"/data/"+CB.appId+"/"+this.tableName+"/findOne",CB._request("POST",url,c).then(function(c){var d=CB.fromJSON(JSON.parse(c));a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudQuery._validateQuery=function(a,b){for(var c in b)if(b[c]){var d=b[c];if("object"==typeof d)if("$or"===c){if(b[c].length>0){for(var e=!1,f=0;f<b[c].length;f++)if(CB.CloudQuery._validateQuery(a,b[c][f])){e=!0;break}if(!e)return!1}}else for(var g in d){if("$ne"===g&&a.get(c)===b[c].$ne)return!1;if("$gt"===g&&a.get(c)<=b[c].$gt)return!1;if("$lt"===g&&a.get(c)>=b[c].$lt)return!1;if("$gte"===g&&a.get(c)<b[c].$gte)return!1;if("$lte"===g&&a.get(c)>b[c].$lte)return!1;if("$exists"===g)if(b[c][g]&&a.get(c));else if(b[c][g]!==!1)return!1;if("$exists"===g&&!b[c][g]&&a.get(c))return!1;if("$regex"===g){var h=new RegExp(b[c][g]);if(b[c].$options){if("im"===b[c].$options){var d=trimStart("^",b[c][g]);if(0!==a.get(c).indexOf(d))return!1}}else if(!h.test(a.get(c)))return!1}if("$in"===g&&b[c][g]){var i=b[c][g],d=null;if(d=c.indexOf(".")>-1?a.get(c.substr(0,c.indexOf("."))):a.get(c),"[object Array]"===Object.prototype.toString.call(d)){for(var j=!1,f=0;f<d.length;f++)if(d[f]instanceof CB.CloudObject){if(i.indexOf(d[f].id)>-1){j=!0;break}}else if(i.indexOf(d[f])>-1){j=!0;break}if(!j)return!1}else if(-1===i.indexOf(d))return!1}if("$nin"===g&&b[c][g]){var i=b[c][g],d=null;if(d=c.indexOf(".")>-1?a.get(c.substr(0,c.indexOf("."))):a.get(c),"[object Array]"===Object.prototype.toString.call(d)){for(var j=!1,f=0;f<d.length;f++)if(d[f]instanceof CB.CloudObject){if(-1!==i.indexOf(d[f].id)){j=!0;break}}else if(-1!==i.indexOf(d[f])){j=!0;break}if(j)return!1}else if(-1!==i.indexOf(d))return!1}if("$all"===g&&b[c][g]){var i=b[c][g],d=null;if(d=c.indexOf(".")>-1?a.get(c.substr(0,c.indexOf("."))):a.get(c),"[object Array]"===Object.prototype.toString.call(d)){for(var f=0;f<d.length;f++)if(d[f]instanceof CB.CloudObject){if(-1===i.indexOf(d[f].id))return!1}else if(-1===i.indexOf(d[f]))return!1}else if(-1===i.indexOf(d))return!1}}else if(-1!==c.indexOf(".")){var k=c.substring(0,c.indexOf("."));if(!a.get(k))return!1;if(a.get(k).id!==b[c])return!1}else if(a.get(c)!==b[c])return!1}return!0},CB.SearchFilter=function(){this.bool={},this.bool.must=[],this.bool.should=[],this.bool.must_not=[],this.$include=[]},CB.SearchFilter.prototype.notEqualTo=function(a,b){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var c={};return b instanceof Array?(c.terms={},c.terms[a]=b):(c.term={},c.term[a]=b),this.bool.must_not.push(c),this},CB.SearchFilter.prototype.equalTo=function(a,b){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var c={};return b instanceof Array?(c.terms={},c.terms[a]=b):null!==b?b.constructor===CB.CloudObject?(b=b.get("id"),c.nested={},c.nested.path=a,c.nested.filter={},c.nested.filter.term={},c.nested.filter.term[a+"._id"]=b):(c.term={},c.term[a]=b):c.term[a]=b,this.bool.must.push(c),this},CB.SearchFilter.prototype.exists=function(a){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var b={};return b.exists={},b.exists.field=a,this.bool.must.push(b),this},CB.SearchFilter.prototype.doesNotExist=function(a){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var b={};return b.missing={},b.missing.field=a,this.bool.must.push(b),this},CB.SearchFilter.prototype.greaterThanOrEqual=function(a,b){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var c={};return c.range={},c.range[a]={},c.range[a].gte=b,this.bool.must.push(c),this},CB.SearchFilter.prototype.greaterThan=function(a,b){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var c={};return c.range={},c.range[a]={},c.range[a].gt=b,this.bool.must.push(c),this},CB.SearchFilter.prototype.lessThan=function(a,b){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var c={};return c.range={},c.range[a]={},c.range[a].lt=b,this.bool.must.push(c),this},CB.SearchFilter.prototype.lessthanOrEqual=function(a,b){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var c={};return c.range={},c.range[a]={},c.range[a].lte=b,this.bool.must.push(c),this},CB.SearchFilter.prototype.near=function(a,b,c){var d={};d.geo_distance={},d.geo_distance.distance=c.toString()+" m",d.geo_distance[a]=b.document.coordinates,this.bool.must.push(d)},CB.SearchFilter.prototype.and=function(a){if(a.$include.length>0)throw"You cannot have an include over AND. Have an CloudSearch Include over parent SearchFilter instead.";if(delete a.$include,!a instanceof CB.SearchFilter)throw"data should be of type CB.SearchFilter";return this.bool.must.push(a),this},CB.SearchFilter.prototype.or=function(a){if(a.$include.length>0)throw"You cannot have an include over OR. Have an CloudSearch Include over parent SearchFilter instead.";if(delete a.$include,!a instanceof CB.SearchFilter)throw"data should be of type CB.SearchFilter";return this.bool.should.push(a),this},CB.SearchFilter.prototype.not=function(a){if(a.$include.length>0)throw"You cannot have an include over NOT. Have an CloudSearch Include over parent SearchFilter instead.";if(delete a.$include,!a instanceof CB.SearchFilter)throw"data should be of type CB.SearchFilter";return this.bool.must_not.push(a),this},CB.SearchFilter.prototype.include=function(a){return"id"===a&&(a="_"+a),this.$include.push(a),this},CB.SearchQuery=function(){this.bool={},this.bool.must=[],this.bool.should=[],this.bool.must_not=[]},CB.SearchQuery.prototype._buildSearchPhrase=function(a,b,c,d){var e=this._buildSearchOn(a,b,null,null,null,d);return a instanceof Array?(e.multi_match.type="phrase",c&&(e.multi_match.slop=c)):(e.match[a].type="phrase",c&&(e.match[a].slop=c)),e},CB.SearchQuery.prototype._buildBestColumns=function(a,b,c,d,e,f){var g=this._buildSearchOn(a,b,c,d,e,f);return a instanceof Array?g.multi_match.type="best_fields":g.match[a].type="best_fields",g},CB.SearchQuery.prototype._buildMostColumns=function(a,b,c,d,e,f){var g=this._buildSearchOn(a,b,c,d,e,f);return a instanceof Array?g.multi_match.type="most_fields":g.match[a].type="most_fields",g},CB.SearchQuery.prototype._buildSearchOn=function(a,b,c,d,e,f){var g={};return a instanceof Array?(g.multi_match={},g.multi_match.query=b,g.multi_match.fields=a,d&&(g.multi_match.operator=d),e&&(g.multi_match.minimum_should_match=e),f&&(g.multi_match.boost=f),c&&(g.multi_match.fuzziness=c)):(g.match={},g.match[a]={},g.match[a].query=b,d&&(g.match[a].operator=d),e&&(g.match[a].minimum_should_match=e),f&&(g.match[a].boost=f),c&&(g.match[a].fuzziness=c)),g},CB.SearchQuery.prototype.searchOn=function(a,b,c,d,e,f){d&&(d="and");var g=this._buildSearchOn(a,b,c,d,e,f);return this.bool.should.push(g),this},CB.SearchQuery.prototype.phrase=function(a,b,c,d){var e=this._buildSearchPhrase(a,b,c,d);return this.bool.should.push(e),this},CB.SearchQuery.prototype.bestColumns=function(a,b,c,d,e,f){if(!a instanceof Array||a.length<2)throw"There should be more than one columns in-order to use this function";d&&(d="and");var g=this._buildBestColumns(a,b,c,d,e,f);return this.bool.should.push(g),this},CB.SearchQuery.prototype.mostColumns=function(a,b,c,d,e,f){if(!a instanceof Array||a.length<2)throw"There should be more than one columns in-order to use this function";d&&(d="and");var g=this._buildMostColumns(a,b,c,d,e,f);return this.bool.should.push(g),this},CB.SearchQuery.prototype.startsWith=function(a,b,c){var d={};d.prefix={},d.prefix[a]={},d.prefix[a].value=b,c&&(d.prefix[a].boost=c),this.bool.must.push(d)},CB.SearchQuery.prototype.wildcard=function(a,b,c){var d={};d.wildcard={},d.wildcard[a]={},d.wildcard[a].value=b,c&&(d.wildcard[a].boost=c),this.bool.should.push(d)},CB.SearchQuery.prototype.regexp=function(a,b,c){var d={};d.regexp={},d.regexp[a]={},d.regexp[a].value=b,c&&(d.regexp[a].boost=c),this.bool.must.push(d)},CB.SearchQuery.prototype.and=function(a){if(!a instanceof CB.SearchQuery)throw"data should be of type CB.SearchQuery";this.bool.must.push(a)},CB.SearchQuery.prototype.or=function(a){if(!a instanceof CB.SearchQuery)throw"data should be of type CB.SearchQuery";this.bool.should.push(a)},CB.SearchQuery.prototype.not=function(a){if(!a instanceof CB.SearchQuery)throw"data should be of type CB.SearchQuery";this.bool.must_not.push(a)},CB.CloudSearch=function(a,b,c){this.collectionNames=a,this.query={},this.query.filtered={},b?this.query.filtered.query=b:this.query.filtered.query={},c?this.query.filtered.filter=c:this.query.filtered.filter={},this.from=0,this.size=10,this.sort=[]},Object.defineProperty(CB.CloudSearch.prototype,"searchFilter",{get:function(){return this.query.filtered.filter},set:function(a){this.query.filtered.filter=a}}),Object.defineProperty(CB.CloudSearch.prototype,"searchQuery",{get:function(){return this.query.filtered.query},set:function(a){this.query.filtered.query=a}}),CB.CloudSearch.prototype.setSkip=function(a){return this.from=a,this},CB.CloudSearch.prototype.setLimit=function(a){return this.size=a,this},CB.CloudSearch.prototype.orderByAsc=function(a){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var b={};return b[a]={},b[a].order="asc",this.sort.push(b),this},CB.CloudSearch.prototype.orderByDesc=function(a){"id"!==a&&"isSearchable"!==a&&"expires"!==a||(a="_"+a);var b={};return b[a]={},b[a].order="desc",this.sort.push(b),this},CB.CloudSearch.prototype.search=function(a){CB._validate();var b,c=null;a||(b=new CB.Promise),c=this.collectionNames instanceof Array?this.collectionNames.join(","):this.collectionNames;var d=JSON.stringify({collectionName:c,query:this.query,sort:this.sort,limit:this.size,skip:this.from,key:CB.appKey}),e=CB.apiUrl+"/data/"+CB.appId+"/"+c+"/search";return CB._request("POST",e,d).then(function(c){var d=CB.fromJSON(JSON.parse(c));a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudRole=CB.CloudRole||function(a){this.document||(this.document={}),this.document._tableName="Role",this.document._type="role",this.document.name=a,this.document.expires=null,this.document.ACL=new CB.ACL,this.document.expires=null,this.document._isModified=!0,this.document._modifiedColumns=["createdAt","updatedAt","ACL","name","expires"]},CB.CloudRole.prototype=Object.create(CB.CloudObject.prototype),Object.defineProperty(CB.CloudRole.prototype,"name",{get:function(){return this.document.name},set:function(a){this.document.name=a,CB._modified(this,a)}}),CB.CloudFile=CB.CloudFile||function(a,b,c){if("[object File]"===Object.prototype.toString.call(a)||"[object Blob]"===Object.prototype.toString.call(a))this.fileObj=a,this.document={_id:null,_type:"file",ACL:new CB.ACL,name:a&&a.name&&""!==a.name?a.name:"unknown",size:a.size,url:null,expires:null,contentType:"undefined"!=typeof a.type&&""!==a.type?a.type:"unknown"};else if("string"==typeof a){var d=RegExp("https?://(?:www.|(?!www))[^s.]+.[^s]{2,}|www.[^s]+.[^s]{2,}");d.test(a)?this.document={_id:null,_type:"file",ACL:new CB.ACL,name:"",size:"",url:a,expires:null,contentType:""}:b?(this.data=b,c||(c=a.split(".")[a.split(".").length-1]),this.document={_id:null,_type:"file",ACL:new CB.ACL,name:a,size:"",url:null,expires:null,contentType:c}):this.document={_id:a,_type:"file"}}},CB.CloudFile.prototype=Object.create(CB.CloudObject.prototype),Object.defineProperty(CB.CloudFile.prototype,"type",{get:function(){return this.document.contentType},set:function(a){this.document.contentType=a}}),Object.defineProperty(CB.CloudFile.prototype,"url",{get:function(){return this.document.url},set:function(a){this.document.url=a}}),Object.defineProperty(CB.CloudFile.prototype,"size",{get:function(){return this.document.size},set:function(a){this.document.size=a}}),Object.defineProperty(CB.CloudFile.prototype,"name",{get:function(){return this.document.name},set:function(a){this.document.name=a}}),CB.CloudFile.prototype.save=function(a){var b;a||(b=new CB.Promise);var c=this;if(!this.fileObj&&!this.data)throw"You cannot save a file which is null";if(this.data){var d=this.data,e=JSON.stringify({data:d,fileObj:CB.toJSON(this),key:CB.appKey});g=CB.apiUrl+"/file/"+CB.appId;var f=null;a&&a.uploadProgress&&(f=a.uploadProgress),CB._request("POST",g,e,null,null,f).then(function(d){c.document=JSON.parse(d),delete c.data,a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)})}else{var e=new FormData;e.append("fileToUpload",this.fileObj),e.append("key",CB.appKey),e.append("fileObj",JSON.stringify(CB.toJSON(c)));var g=CB.apiUrl+"/file/"+CB.appId,f=null;a&&a.uploadProgress&&(f=a.uploadProgress),CB._request("POST",g,e,!1,!0,f).then(function(d){c.document=JSON.parse(d),a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)})}return a?void 0:b},CB.CloudFile.prototype["delete"]=function(a){var b;if(!this.url)throw"You cannot delete a file which does not have an URL";a||(b=new CB.Promise);var c=this,d=JSON.stringify({fileObj:CB.toJSON(c),key:CB.appKey,method:"PUT"}),e=CB.apiUrl+"/file/"+CB.appId+"/"+this.document._id;return CB._request("PUT",e,d).then(function(d){c.url=null,a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudFile.prototype.getFileContent=function(a){var b;if(!this.url)throw"URL is null. Fetch this file object first using fetch()";a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey}),d=this.url;return CB._request("GET",d,c).then(function(c){a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudGeoPoint=CB.CloudGeoPoint||function(a,b){if(!b&&0!==b||!a&&0!==a)throw"Latitude or Longitude is empty.";if(isNaN(b))throw"Latitude "+b+" is not a number type.";if(isNaN(a))throw"Longitude "+a+" is not a number type.";if(this.document={},this.document._type="point",this.document._isModified=!0,!(Number(b)>=-90&&Number(b)<=90&&Number(a)>=-180&&Number(a)<=180))throw"latitude and longitudes are not in range";this.document.coordinates=[Number(a),Number(b)],this.document.latitude=Number(b),this.document.longitude=Number(a)},Object.defineProperty(CB.CloudGeoPoint.prototype,"latitude",{get:function(){return this.document.coordinates[1]},set:function(a){if(!(Number(a)>=-90&&Number(a)<=90))throw"Latitude is not in Range";this.document.latitude=Number(a),this.document.coordinates[1]=Number(a),this.document._isModified=!0}}),Object.defineProperty(CB.CloudGeoPoint.prototype,"longitude",{get:function(){return this.document.coordinates[0]},set:function(a){if(!(Number(a)>=-180&&Number(a)<=180))throw"Longitude is not in Range";this.document.longitude=Number(a),this.document.coordinates[0]=Number(a),this.document._isModified=!0}}),CB.CloudGeoPoint.prototype.get=function(a){return this.document[a]},CB.CloudGeoPoint.prototype.set=function(a,b){if("latitude"===a){if(!(Number(b)>=-90&&Number(b)<=90))throw"Latitude is not in Range";this.document.latitude=Number(b),this.document.coordinates[1]=Number(b),this.document._isModified=!0}else{if(!(Number(b)>=-180&&Number(b)<=180))throw"Latitude is not in Range";this.document.longitude=Number(b),this.document.coordinates[0]=Number(b),this.document._isModified=!0}},CB.CloudGeoPoint.prototype.distanceInKMs=function(a){var b=6371;return b*greatCircleFormula(this,a)},CB.CloudGeoPoint.prototype.distanceInMiles=function(a){var b=3959;return b*greatCircleFormula(this,a)},CB.CloudGeoPoint.prototype.distanceInRadians=function(a){return greatCircleFormula(this,a)},"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),CB.CloudTable=function(a){CB._tableValidation(a),this.document={},this.document.name=a,this.document.appId=CB.appId,this.document._type="table","user"===a.toLowerCase()?(this.document.type="user",this.document.maxCount=1):"role"===a.toLowerCase()?(this.document.type="role",this.document.maxCount=1):"device"===a.toLowerCase()?(this.document.type="device",this.document.maxCount=1):(this.document.type="custom",this.document.maxCount=9999),this.document.columns=CB._defaultColumns(this.document.type)},Object.defineProperty(CB.CloudTable.prototype,"columns",{get:function(){return this.document.columns}}),Object.defineProperty(CB.CloudTable.prototype,"name",{get:function(){return this.document.name},set:function(){throw"You can not rename a table"}}),Object.defineProperty(CB.CloudTable.prototype,"id",{get:function(){return this.document._id}}),CB.CloudTable.prototype.addColumn=function(a){if("[object String]"===Object.prototype.toString.call(a)){var b=new CB.Column(a);a=b}if("[object Object]"===Object.prototype.toString.call(a))CB._columnValidation(a,this)&&this.document.columns.push(a);else if("[object Array]"===Object.prototype.toString.call(a))for(var c=0;c<a.length;c++)CB._columnValidation(a[c],this)&&this.document.columns.push(a[c])},CB.CloudTable.prototype.getColumn=function(a){if("[object String]"!==Object.prototype.toString.call(a))throw"Should enter a columnName";for(var b=this.document.columns,c=0;c<b.length;c++)if(b[c].name===a)return b[c];throw"Column Does Not Exists"},CB.CloudTable.prototype.updateColumn=function(a){if("[object Object]"!==Object.prototype.toString.call(a))throw"Invalid Column";if(!CB._columnValidation(a,this))throw"Invalid Column";for(var b=this.document.columns,c=0;c<b.length;c++)if(b[c].name===a.name){b[c]=a,this.document.columns=b;break}},CB.CloudTable.prototype.deleteColumn=function(a){if("[object String]"===Object.prototype.toString.call(a)){var b=new CB.Column(a);a=b}if("[object Object]"===Object.prototype.toString.call(a)){if(CB._columnValidation(a,this)){for(var c=[],d=0;d<this.columns.length;d++)this.columns[d].name!==a.name&&c.push(this.columns[d]);this.document.columns=c}}else if("[object Array]"===Object.prototype.toString.call(a))for(var c=[],d=0;d<a.length;d++)if(CB._columnValidation(a[d],this)){for(var d=0;d<this.columns.length;d++)this.columns[d].name!==a[d].name&&c.push(this.columns[d]);this.document.columns=c}},CB.CloudTable.getAll=function(a){if(!CB.appId)throw"CB.appId is null.";var b;a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey}),d=CB.apiUrl+"/app/"+CB.appId+"/_getAll";return CB._request("POST",d,c,!0).then(function(c){c=JSON.parse(c);var d=CB.fromJSON(c);a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudTable.get=function(a,b){if("[object String]"===Object.prototype.toString.call(a)){var c=new CB.CloudTable(a);a=c}if("[object Object]"===Object.prototype.toString.call(a)){if(!CB.appId)throw"CB.appId is null.";var d;b||(d=new CB.Promise);var e=JSON.stringify({key:CB.appKey,appId:CB.appId}),f=CB.apiUrl+"/app/"+CB.appId+"/"+a.document.name;if(CB._request("POST",f,e,!0).then(function(a){if("null"===a||""===a)c=null;else{a=JSON.parse(a);var c=CB.fromJSON(a)}b?b.success(c):d.resolve(c)},function(a){b?b.error(a):d.reject(a)}),!b)return d}else if("[object Array]"===Object.prototype.toString.call(a))throw"cannot fetch array of tables"},CB.CloudTable.prototype["delete"]=function(a){CB._validate();var b;
a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey,name:this.name,method:"DELETE"}),d=this,e=CB.apiUrl+"/app/"+CB.appId+"/"+this.name;return CB._request("PUT",e,c,!0).then(function(c){a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudTable.prototype.save=function(a){var b;a||(b=new CB.Promise),CB._validate();var c=this,d=JSON.stringify({key:CB.appKey,data:CB.toJSON(c)}),c=this,e=CB.apiUrl+"/app/"+CB.appId+"/"+c.document.name;return CB._request("PUT",e,d,!0).then(function(d){d=JSON.parse(d),c=CB.fromJSON(d),a?a.success(c):b.resolve(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.Column=function(a,b,c,d){this.document={},a&&(CB._columnNameValidation(a),this.document.name=a,this.document._type="column"),b?(CB._columnDataTypeValidation(b),this.document.dataType=b):this.document.dataType="Text","boolean"==typeof c?this.document.required=c:this.document.required=!1,"boolean"==typeof d?this.document.unique=d:this.document.unique=!1,this.document.relatedTo=null,this.document.relationType=null,this.document.isDeletable=!0,this.document.isEditable=!0,this.document.isRenamable=!1},Object.defineProperty(CB.Column.prototype,"name",{get:function(){return this.document.name},set:function(a){this.document.name=a}}),Object.defineProperty(CB.Column.prototype,"dataType",{get:function(){return this.document.dataType},set:function(a){this.document.dataType=a}}),Object.defineProperty(CB.Column.prototype,"unique",{get:function(){return this.document.unique},set:function(a){this.document.unique=a}}),Object.defineProperty(CB.Column.prototype,"relatedTo",{get:function(){return this.document.relatedTo},set:function(a){this.document.relatedTo=a}}),Object.defineProperty(CB.Column.prototype,"required",{get:function(){return this.document.required},set:function(a){this.document.required=a}}),CB.CloudQueue=function(a,b){if("undefined"==typeof a||null==a)throw"Cannot create a queue with empty name";if(this.document={},this.document.ACL=new CB.ACL,this.document._type="queue",this.document.expires=null,this.document.name=a,this.document.retry=null,this.document.subscribers=[],this.document.messages=[],b&&"push"!==b&&"pull"!==b)throw"Type can be push or pull";b?this.document.queueType=b:this.document.queueType="pull"},Object.defineProperty(CB.CloudQueue.prototype,"retry",{get:function(){return this.document.retry},set:function(a){if("push"!==this.queueType)throw"Queue Type should be push to set this property";this.document.retry=a,CB._modified(this,"retry")}}),Object.defineProperty(CB.CloudQueue.prototype,"size",{get:function(){return this.document.size?this.document.size:0}}),Object.defineProperty(CB.CloudQueue.prototype,"name",{get:function(){return this.document.name}}),Object.defineProperty(CB.CloudQueue.prototype,"subscribers",{get:function(){return this.document.subscribers}}),Object.defineProperty(CB.CloudQueue.prototype,"type",{get:function(){return this.document.queueType},set:function(a){this.document.queueType=a,CB._modified(this,"queueType")}}),Object.defineProperty(CB.CloudQueue.prototype,"ACL",{get:function(){return this.document.ACL},set:function(a){this.document.ACL=a,CB._modified(this,"ACL")}}),Object.defineProperty(CB.CloudQueue.prototype,"id",{get:function(){return this.document._id}}),Object.defineProperty(CB.CloudQueue.prototype,"createdAt",{get:function(){return this.document.createdAt}}),Object.defineProperty(CB.CloudQueue.prototype,"updatedAt",{get:function(){return this.document.updatedAt}}),Object.defineProperty(CB.CloudQueue.prototype,"expires",{get:function(){return this.document.expires},set:function(a){this.document.expires=a,CB._modified(this,"expires")}}),CB.CloudQueue.prototype.addMessage=function(a,b){if(null==a)throw"Message cannot be null";var c;CB._validate(),b||(c=new CB.Promise);var d=[];a.constructor!==Array?d.push(a):d=a;for(var e=0;e<d.length;e++)d[e]instanceof CB.QueueMessage||(d[e]=new CB.QueueMessage(d[e]));this.document.messages=d;var f=this,g=(CB._loadXml(),JSON.stringify({document:CB.toJSON(f),key:CB.appKey})),h=CB.apiUrl+"/queue/"+CB.appId+"/"+f.document.name+"/message";CB._request("PUT",h,g).then(function(a){var d=CB.fromJSON(JSON.parse(a));b?b.success(d):c.resolve(d)},function(a){b?b.error(a):c.reject(a)})},CB.CloudQueue.prototype.updateMessage=function(a,b){if(null==a)throw"Message cannot be null";var c;CB._validate(),b||(c=new CB.Promise);var d=[];if(a.constructor!==Array){if(!a.id)throw"Message cannot be updated because it has never been saved.";d.push(a)}else{d=a;for(var e=0;e<d.length;e++){if(!(d[e]instanceof CB.QueueMessage))throw"Message is not an instance of QueueMessage.";if(!message[e].id)throw"Message cannot be updated because it has never been saved."}}return this.addMessage(a,b)},CB.CloudQueue.prototype.getMessage=function(a,b){var c;CB._validate(),b||(c=new CB.Promise),"object"!=typeof a||b||(b=a,a=null),a||(a=1);var d=this,e=(CB._loadXml(),JSON.stringify({count:a,key:CB.appKey})),f=CB.apiUrl+"/queue/"+CB.appId+"/"+d.document.name+"/getMessage";CB._request("POST",f,e).then(function(a){a&&""!==a||(a=null),b?b.success(CB.fromJSON(JSON.parse(a))):c.resolve(CB.fromJSON(JSON.parse(a)))},function(a){b?b.error(a):c.reject(a)})},CB.CloudQueue.prototype.getAllMessages=function(a){var b;CB._validate(),a||(b=new CB.Promise),"object"!=typeof count||a||(a=count,count=null);var c=this,d=(CB._loadXml(),JSON.stringify({key:CB.appKey})),e=CB.apiUrl+"/queue/"+CB.appId+"/"+c.document.name+"/messages";CB._request("POST",e,d).then(function(c){c&&""!==c||(c=null),a?a.success(CB.fromJSON(JSON.parse(c))):b.resolve(CB.fromJSON(JSON.parse(c)))},function(c){a?a.error(c):b.reject(c)})},CB.CloudQueue.prototype.getMessageById=function(a,b){var c;CB._validate(),b||(c=new CB.Promise);var d=(CB._loadXml(),JSON.stringify({key:CB.appKey})),e=CB.apiUrl+"/queue/"+CB.appId+"/"+this.document.name+"/message/"+a;CB._request("POST",e,d).then(function(a){a&&""!==a||(a=null),b?b.success(CB.fromJSON(JSON.parse(a))):c.resolve(CB.fromJSON(JSON.parse(a)))},function(a){b?b.error(a):c.reject(a)})},CB.CloudQueue.prototype.get=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=(CB._loadXml(),this),d=JSON.stringify({key:CB.appKey}),e=CB.apiUrl+"/queue/"+CB.appId+"/"+c.document.name+"/";CB._request("POST",e,d).then(function(d){a?a.success(CB.fromJSON(JSON.parse(d),c)):b.resolve(CB.fromJSON(JSON.parse(d),c))},function(c){a?a.error(c):b.reject(c)})},CB.CloudQueue.prototype.create=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=(CB._loadXml(),this),d=JSON.stringify({key:CB.appKey,document:CB.toJSON(c)}),e=CB.apiUrl+"/queue/"+CB.appId+"/"+c.document.name+"/create";CB._request("POST",e,d).then(function(d){a?a.success(CB.fromJSON(JSON.parse(d),c)):b.resolve(CB.fromJSON(JSON.parse(d),c))},function(c){a?a.error(c):b.reject(c)})},CB.CloudQueue.prototype.addSubscriber=function(a,b){var c;CB._validate(),b||(c=new CB.Promise);var d=(CB._loadXml(),this.document.subscribers);if(this.document.subscribers=[],a.constructor===Array)for(var e=0;e<a.length;e++)this.document.subscribers.push(a[e]);else this.document.subscribers.push(a);var f=JSON.stringify({key:CB.appKey,document:CB.toJSON(this)}),g=this,a=CB.apiUrl+"/queue/"+CB.appId+"/"+g.document.name+"/subscriber/";CB._request("POST",a,f).then(function(a){g=CB.fromJSON(JSON.parse(a),g),b?b.success(g):c.resolve(g)},function(a){g.document.subscribers=d,b?b.error(a):c.reject(a)})},CB.CloudQueue.prototype.removeSubscriber=function(a,b){var c;CB._validate(),b||(c=new CB.Promise);var d=(CB._loadXml(),this.document.subscribers);if(this.document.subscribers=[],a.constructor===Array)for(var e=0;e<a.length;e++)this.document.subscribers.push(a[e]);else this.document.subscribers.push(a);var f=this,g=JSON.stringify({key:CB.appKey,document:CB.toJSON(f),method:"DELETE"}),a=CB.apiUrl+"/queue/"+CB.appId+"/"+f.document.name+"/subscriber/";CB._request("PUT",a,g).then(function(a){f=CB.fromJSON(JSON.parse(a),f),b?b.success(f):c.resolve(f)},function(a){this.document.subscribers=d,b?b.error(a):c.reject(a)})},CB.CloudQueue.prototype.peekMessage=function(a,b){var c;CB._validate(),b||(c=new CB.Promise),"object"!=typeof a||b||(b=a,a=null),a||(a=1);var d=(CB._loadXml(),JSON.stringify({key:CB.appKey,count:a})),e=CB.apiUrl+"/queue/"+CB.appId+"/"+this.document.name+"/peekMessage";CB._request("POST",e,d).then(function(a){b?b.success(CB.fromJSON(JSON.parse(a))):c.resolve(CB.fromJSON(JSON.parse(a)))},function(a){b?b.error(a):c.reject(a)})},CB.CloudQueue.prototype["delete"]=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=(CB._loadXml(),JSON.stringify({key:CB.appKey,document:CB.toJSON(this),method:"DELETE"})),d=this,e=CB.apiUrl+"/queue/"+CB.appId+"/"+d.document.name;CB._request("PUT",e,c).then(function(c){d=CB.fromJSON(JSON.parse(c),d),a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)})},CB.CloudQueue.prototype.clear=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=(CB._loadXml(),JSON.stringify({key:CB.appKey,document:CB.toJSON(this),method:"DELETE"})),d=this,e=CB.apiUrl+"/queue/"+CB.appId+"/"+d.document.name+"/clear";CB._request("PUT",e,c).then(function(c){d=CB.fromJSON(JSON.parse(c),d),a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)})},CB.CloudQueue.prototype.refreshMessageTimeout=function(a,b,c){var d;if(CB._validate(),c||(d=new CB.Promise),!a)throw"Message Id cannot be null";if(a instanceof CB.QueueMessage){if(!a.id)throw"Queue Message should have an id.";a=a.id}c||!b.success&&!b.error||(c=b,b=null);var e=(CB._loadXml(),JSON.stringify({key:CB.appKey,timeout:b})),f=this,g=CB.apiUrl+"/queue/"+CB.appId+"/"+f.document.name+"/"+a+"/refresh-message-timeout";CB._request("PUT",g,e).then(function(a){c?c.success(CB.fromJSON(JSON.parse(a))):d.resolve(CB.fromJSON(JSON.parse(a)))},function(a){c?c.error(a):d.reject(a)})},CB.CloudQueue.prototype.deleteMessage=function(a,b){var c;if(CB._validate(),!a||!(a instanceof CB.QueueMessage)&&"string"!=typeof a)throw"Delete Message function should have id of the message or insance of QueueMessage as the first parameter. ";a instanceof CB.QueueMessage&&(a=a.id),b||(c=new CB.Promise);var d=(CB._loadXml(),JSON.stringify({key:CB.appKey,method:"DELETE"})),e=this,f=CB.apiUrl+"/queue/"+CB.appId+"/"+e.document.name+"/message/"+a;CB._request("PUT",f,d).then(function(a){b?b.success(CB.fromJSON(JSON.parse(a))):c.resolve(CB.fromJSON(JSON.parse(a)))},function(a){b?b.error(a):c.reject(a)})},CB.CloudQueue.prototype.update=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=(CB._loadXml(),this),d=JSON.stringify({key:CB.appKey,document:CB.toJSON(c)}),e=CB.apiUrl+"/queue/"+CB.appId+"/"+c.document.name;CB._request("PUT",e,d).then(function(d){a?a.success(CB.fromJSON(JSON.parse(d),c)):b.resolve(CB.fromJSON(JSON.parse(d),c))},function(c){a?a.error(c):b.reject(c)})},CB.CloudQueue.getAll=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=(CB._loadXml(),JSON.stringify({key:CB.appKey})),d=CB.apiUrl+"/queue/"+CB.appId+"/";CB._request("POST",d,c).then(function(c){""===c&&(c=null),a?a.success(CB.fromJSON(JSON.parse(c))):b.resolve(CB.fromJSON(JSON.parse(c)))},function(c){a?a.error(c):b.reject(c)})},CB.CloudQueue.get=function(a,b){var c=new CB.CloudQueue(a);return c.get(b)},CB.CloudQueue["delete"]=function(a,b){var c=new CB.CloudQueue(a);return c["delete"](b)},CB.QueueMessage=function(a){this.document={},this.document.ACL=new CB.ACL,this.document._type="queue-message",this.document.expires=null,this.document.timeout=1800,this.document.delay=null,this.document.message=a,this.document._id=null,this.document._modifiedColumns=["createdAt","updatedAt","ACL","expires","timeout","delay","message"],this.document._isModified=!0},Object.defineProperty(CB.QueueMessage.prototype,"message",{get:function(){return this.document.message},set:function(a){this.document.message=a,CB._modified(this,"message")}}),Object.defineProperty(CB.QueueMessage.prototype,"ACL",{get:function(){return this.document.ACL},set:function(a){this.document.ACL=a,CB._modified(this,"ACL")}}),Object.defineProperty(CB.QueueMessage.prototype,"id",{get:function(){return this.document._id}}),Object.defineProperty(CB.QueueMessage.prototype,"createdAt",{get:function(){return this.document.createdAt},set:function(a){this.document.createdAt=a,CB._modified(this,"createdAt")}}),Object.defineProperty(CB.QueueMessage.prototype,"updatedAt",{get:function(){return this.document.updatedAt},set:function(a){this.document.updatedAt=a,CB._modified(this,"updatedAt")}}),Object.defineProperty(CB.QueueMessage.prototype,"expires",{get:function(){return this.document.expires},set:function(a){this.document.expires=a,CB._modified(this,"expires")}}),Object.defineProperty(CB.QueueMessage.prototype,"timeout",{get:function(){return this.document.timeout},set:function(a){this.document.timeout=a,CB._modified(this,"timeout")}}),Object.defineProperty(CB.QueueMessage.prototype,"delay",{get:function(){return this.document.delay?this.document.delay/1e3:0},set:function(a){a*=1e3,this.document.delay=a,CB._modified(this,"delay")}}),CB.CloudCache=function(a){if("undefined"==typeof a||null===a||""===a)throw"Cannot create a cache with empty name";this.document={},this.document._tableName="cache",this.document.name=a,this.document.size="",this.document.items=[]},Object.defineProperty(CB.CloudCache.prototype,"name",{get:function(){return this.document.name}}),Object.defineProperty(CB.CloudCache.prototype,"size",{get:function(){return this.document.size}}),Object.defineProperty(CB.CloudCache.prototype,"items",{get:function(){return this.document.items}}),CB.CloudCache.prototype.set=function(a,b,c){var d;if(CB._validate(),c||(d=new CB.Promise),"undefined"==typeof b)throw"Value cannot be undefined.";var e=JSON.stringify({key:CB.appKey,item:b}),f=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name+"/"+a;return CB._request("PUT",f,e,!0).then(function(a){CB._isJsonString(a)&&(a=JSON.parse(a));var b=CB.fromJSON(a);c?c.success(b):d.resolve(b)},function(a){c?c.error(a):d.reject(a)}),c?void 0:d},CB.CloudCache.prototype.deleteItem=function(a,b){var c;CB._validate(),b||(c=new CB.Promise);var d=JSON.stringify({key:CB.appKey,method:"DELETE"}),e=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name+"/item/"+a;return CB._request("PUT",e,d,!0).then(function(a){CB._isJsonString(a)&&(a=JSON.parse(a));var d=CB.fromJSON(a);b?b.success(d):c.resolve(d)},function(a){b?b.error(a):c.reject(a)}),b?void 0:c},CB.CloudCache.prototype.create=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey}),d=this,e=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name+"/create";return CB._request("POST",e,c,!0).then(function(c){CB._isJsonString(c)&&(c=JSON.parse(c));var e=CB.fromJSON(c,d);a?a.success(e):b.resolve(e)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudCache.prototype.get=function(a,b){var c;CB._validate(),b||(c=new CB.Promise);var d=JSON.stringify({key:CB.appKey}),e=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name+"/"+a+"/item";return CB._request("POST",e,d,!0).then(function(a){CB._isJsonString(a)&&(a=JSON.parse(a));var d=CB.fromJSON(a);b?b.success(d):c.resolve(d)},function(a){b?b.error(a):c.reject(a)}),b?void 0:c},CB.CloudCache.prototype.getInfo=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey}),d=this,e=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name;return CB._request("POST",e,c,!0).then(function(c){CB._isJsonString(c)&&(c=JSON.parse(c));var e=CB.fromJSON(c,d);a?a.success(e):b.resolve(e)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudCache.prototype.getItemsCount=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey}),d=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name+"/items/count";return CB._request("POST",d,c,!0).then(function(c){CB._isJsonString(c)&&(c=JSON.parse(c));var d=CB.fromJSON(c);a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudCache.prototype.getAll=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=this,d=JSON.stringify({key:CB.appKey}),e=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name+"/items";return CB._request("POST",e,d,!0).then(function(d){CB._isJsonString(d)&&(d=JSON.parse(d));var e=CB.fromJSON(d);c.document.items=e,a?a.success(e):b.resolve(e)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudCache.prototype.clear=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey,method:"DELETE"}),d=this,e=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name+"/clear/items";return CB._request("PUT",e,c,!0).then(function(c){CB._isJsonString(c)&&(c=JSON.parse(c));var e=CB.fromJSON(c,d);a?a.success(e):b.resolve(e)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudCache.prototype["delete"]=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey,method:"DELETE"}),d=this,e=CB.apiUrl+"/cache/"+CB.appId+"/"+this.document.name;return CB._request("PUT",e,c,!0).then(function(c){CB._isJsonString(c)&&(c=JSON.parse(c));var e=CB.fromJSON(c,d);a?a.success(e):b.resolve(e)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudCache.getAll=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey}),d=CB.apiUrl+"/cache/"+CB.appId;return CB._request("POST",d,c,!0).then(function(c){CB._isJsonString(c)&&(c=JSON.parse(c));var d=CB.fromJSON(c);a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudCache.deleteAll=function(a){var b;CB._validate(),a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey,method:"DELETE"}),d=CB.apiUrl+"/cache/"+CB.appId;return CB._request("PUT",d,c,!0).then(function(c){CB._isJsonString(c)&&(c=JSON.parse(c));var d=CB.fromJSON(c);a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudPush={},CB.CloudPush.send=function(a,b,c){var d="Device";if(!CB.appId)throw"CB.appId is null.";var e;if(c||(e=new CB.Promise),!a)throw"data object is null.";if(a&&!a.message)throw"message is not set.";if(b&&"[object Object]"==Object.prototype.toString.call(b)&&"function"!=typeof b.success)var f=b;if(b&&"[object Array]"==Object.prototype.toString.call(b)&&"function"!=typeof b.success){var f=new CB.CloudQuery(d);f.containedIn("channels",b)}if(b&&"[object String]"==Object.prototype.toString.call(b)&&"function"!=typeof b.success){var f=new CB.CloudQuery(d);f.containedIn("channels",[b])}if(b&&"[object Object]"==Object.prototype.toString.call(b)&&"function"==typeof b.success){c=b;var f=new CB.CloudQuery(d)}if(!b)var f=new CB.CloudQuery(d);var g=JSON.stringify({query:f.query,sort:f.sort,limit:f.limit,skip:f.skip,key:CB.appKey,data:a});return url=CB.apiUrl+"/push/"+CB.appId+"/send",CB._request("POST",url,g).then(function(a){var b=JSON.parse(a);c?c.success(b):e.resolve(b)},function(a){try{a=JSON.parse(a)}catch(b){}c?c.error(a):e.reject(a)}),c?void 0:e},CB.CloudUser=CB.CloudUser||function(){this.document||(this.document={}),this.document._tableName="User",this.document.expires=null,this.document._type="user",this.document.expires=null,this.document.ACL=new CB.ACL,this.document._isModified=!0,this.document._modifiedColumns=["createdAt","updatedAt","ACL","expires"]},CB.CloudUser.getCurrentUser=function(a){var b;a||(b=new CB.Promise);var c=JSON.stringify({key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/currentUser",CB._request("POST",url,c).then(function(c){var d=c;if(c)try{d=new CB.CloudUser,CB.fromJSON(JSON.parse(c),d),CB.CloudUser.current=d,CB.CloudUser._setCurrentUser(d)}catch(e){}a?a.success(d):b.resolve(d)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudUser._getCurrentUser=function(){var a=CB._getCookie("CBCurrentUser");return a&&a.length>0?CB.fromJSON(JSON.parse(a)):null},CB.CloudUser._setCurrentUser=function(a){a&&CB._createCookie("CBCurrentUser",JSON.stringify(CB.toJSON(a)),2592e6)},CB.CloudUser._removeCurrentUser=function(){CB._deleteCookie("CBCurrentUser")},CB.CloudUser.resetPassword=function(a,b){if(!a)throw"Email is required.";var c;b||(c=new CB.Promise);var d=JSON.stringify({email:a,key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/resetPassword",CB._request("POST",url,d).then(function(a){b?b.success():c.resolve()},function(a){b?b.error(a):c.reject(a)}),b?void 0:c},CB.CloudUser.prototype=Object.create(CB.CloudObject.prototype),Object.defineProperty(CB.CloudUser.prototype,"username",{get:function(){return this.document.username},set:function(a){this.document.username=a,CB._modified(this,"username")}}),Object.defineProperty(CB.CloudUser.prototype,"password",{get:function(){return this.document.password},set:function(a){this.document.password=a,CB._modified(this,"password")}}),Object.defineProperty(CB.CloudUser.prototype,"email",{get:function(){return this.document.email},set:function(a){this.document.email=a,CB._modified(this,"email")}}),CB.CloudUser.current=CB.CloudUser._getCurrentUser(),CB.CloudUser.prototype.signUp=function(a){if(CB._isNode)throw"Error : You cannot signup the user on the server. Use CloudUser.save() instead.";if(!this.document.username)throw"Username is not set.";if(!this.document.password)throw"Password is not set.";if(!this.document.email)throw"Email is not set.";var b,c=this;a||(b=new CB.Promise);var d=JSON.stringify({document:CB.toJSON(c),key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/signup",CB._request("POST",url,d).then(function(d){CB.fromJSON(JSON.parse(d),c),CB.CloudUser.current=c,a?a.success(c):b.resolve(c),CB.CloudUser._setCurrentUser(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudUser.prototype.changePassword=function(a,b,c){var d,e=this;c||(d=new CB.Promise);var f=JSON.stringify({oldPassword:a,newPassword:b,key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/changePassword",CB._request("PUT",url,f).then(function(a){c?c.success(CB.fromJSON(JSON.parse(a),e)):d.resolve(CB.fromJSON(JSON.parse(a),e))},function(a){c?c.error(a):d.reject(a)}),c?void 0:d},CB.CloudUser.prototype.logIn=function(a){if(CB._isNode)throw"Error : You cannot login the user on the server.";if(!this.document.username)throw"Username is not set.";if(!this.document.password)throw"Password is not set.";var b,c=this;a||(b=new CB.Promise);var d=JSON.stringify({document:CB.toJSON(c),key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/login",CB._request("POST",url,d).then(function(d){c=CB.fromJSON(JSON.parse(d),c),CB.CloudUser.current=c,a?a.success(c):b.resolve(c),CB.CloudUser._setCurrentUser(c)},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudUser.prototype.logOut=function(a){if(CB._isNode)throw"Error : You cannot logOut the user on the server.";var b,c=this;a||(b=new CB.Promise);var d=JSON.stringify({document:CB.toJSON(c),key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/logout",CB._request("POST",url,d).then(function(d){CB.fromJSON(JSON.parse(d),c),CB.CloudUser.current=null,a?a.success(c):b.resolve(c),CB.CloudUser._removeCurrentUser()},function(c){a?a.error(c):b.reject(c)}),a?void 0:b},CB.CloudUser.prototype.addToRole=function(a,b){if(!a)throw"Role is null";var c,d=this;b||(c=new CB.Promise);var e=JSON.stringify({user:CB.toJSON(d),role:CB.toJSON(a),key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/addToRole",CB._request("PUT",url,e).then(function(a){CB.fromJSON(JSON.parse(a),d),b?b.success(d):c.resolve(d)},function(a){b?b.error(a):c.reject(a)}),b?void 0:c},CB.CloudUser.prototype.isInRole=function(a){if(!a)throw"role is null";var b=this.get("roles"),c=[];if(b&&b.length>0)for(var d=0;d<b.length;++d)c.push(b[d].document._id);return c.indexOf(a.document._id)>=0},CB.CloudUser.prototype.removeFromRole=function(a,b){if(!a)throw"Role is null";var c,d=this;b||(c=new CB.Promise);var e=JSON.stringify({user:CB.toJSON(d),role:CB.toJSON(a),key:CB.appKey});return url=CB.apiUrl+"/user/"+CB.appId+"/removeFromRole",CB._request("PUT",url,e).then(function(a){CB.fromJSON(JSON.parse(a),d),b?b.success(d):c.resolve(d)},function(a){b?b.error(a):c.reject(a)}),b?void 0:c};